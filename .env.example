# AX Microservice API System - Environment Configuration
# Copy this file to .env and customize the values

# ============================================================================
# Vision Language Model API Keys (VL API 필수)
# ============================================================================

# Anthropic Claude API Key
# Get your key from: https://console.anthropic.com/
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# OpenAI API Key (for GPT-4V)
# Get your key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=your_openai_api_key_here

# ============================================================================
# Service Ports (20개 서비스)
# ============================================================================

# Gateway (Orchestrator)
GATEWAY_PORT=8000

# Frontend
WEB_UI_PORT=5173

# Detection
YOLO_API_PORT=5005

# OCR Services (8개)
EDOCR2_PORT=5002
PADDLEOCR_PORT=5006
TESSERACT_PORT=5008
TROCR_PORT=5009
OCR_ENSEMBLE_PORT=5011
SURYA_OCR_PORT=5013
DOCTR_PORT=5014
EASYOCR_PORT=5015

# Segmentation
EDGNET_PORT=5012
LINE_DETECTOR_PORT=5016

# Preprocessing
ESRGAN_PORT=5010

# Analysis
SKINMODEL_PORT=5003
PID_ANALYZER_PORT=5018
DESIGN_CHECKER_PORT=5019
BLUEPRINT_BOM_PORT=5020

# Visualization
PID_COMPOSER_PORT=5021

# AI
VL_API_PORT=5004

# Knowledge
KNOWLEDGE_PORT=5007

# ============================================================================
# Security Configuration (Optional)
# ============================================================================

# API Authentication (Optional)
# Set to 'true' to enable API key authentication
ENABLE_AUTH=false

# API Key for authentication
# Generate a strong random key: openssl rand -hex 32
API_KEY=your-secret-api-key-here

# Path to security config YAML (optional, overrides API_KEY if provided)
# SECURITY_CONFIG=/path/to/security_config.yaml

# ============================================================================
# Rate Limiting Configuration (Optional)
# ============================================================================

# Enable rate limiting (Optional)
# Set to 'true' to prevent abuse and DoS attacks
ENABLE_RATE_LIMIT=false

# Rate limits per IP address
RATE_LIMIT_PER_MINUTE=30
RATE_LIMIT_PER_HOUR=500
RATE_LIMIT_PER_DAY=3000

# ============================================================================
# Service URLs (Internal - Docker network)
# ============================================================================

# These are used for inter-service communication within Docker

# Detection
YOLO_API_URL=http://yolo-api:5005

# OCR Services
EDOCR2_URL=http://edocr2-v2-api:5002
PADDLEOCR_URL=http://paddleocr-api:5006
TESSERACT_URL=http://tesseract-api:5008
TROCR_URL=http://trocr-api:5009
OCR_ENSEMBLE_URL=http://ocr-ensemble-api:5011
SURYA_OCR_URL=http://surya-ocr-api:5013
DOCTR_URL=http://doctr-api:5014
EASYOCR_URL=http://easyocr-api:5015

# Segmentation
EDGNET_URL=http://edgnet-api:5012
LINE_DETECTOR_URL=http://line-detector-api:5016

# Preprocessing
ESRGAN_URL=http://esrgan-api:5010

# Analysis
SKINMODEL_URL=http://skinmodel-api:5003
PID_ANALYZER_URL=http://pid-analyzer-api:5018
DESIGN_CHECKER_URL=http://design-checker-api:5019
PID_COMPOSER_URL=http://pid-composer-api:5021

# AI
VL_API_URL=http://vl-api:5004

# Knowledge
KNOWLEDGE_API_URL=http://knowledge-api:5007

# ============================================================================
# Circuit Breaker Configuration (Advanced)
# ============================================================================

# Number of consecutive failures before opening circuit
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Time in seconds before attempting to close circuit
CIRCUIT_BREAKER_TIMEOUT=60

# ============================================================================
# Retry Configuration (Advanced)
# ============================================================================

# Maximum retry attempts for failed requests
RETRY_MAX_ATTEMPTS=3

# Initial delay in seconds before first retry
RETRY_INITIAL_DELAY=1.0

# Maximum delay in seconds between retries
RETRY_MAX_DELAY=10.0

# Exponential backoff base
RETRY_EXPONENTIAL_BASE=2.0

# ============================================================================
# Logging Configuration
# ============================================================================

# Log level: debug, info, warning, error, critical
GATEWAY_LOG_LEVEL=info
EDOCR2_LOG_LEVEL=info
EDGNET_LOG_LEVEL=info
SKINMODEL_LOG_LEVEL=info
VL_API_LOG_LEVEL=info
YOLO_LOG_LEVEL=info
PADDLEOCR_LOG_LEVEL=info

# ============================================================================
# Performance Configuration
# ============================================================================

# Number of worker processes per service
GATEWAY_WORKERS=4
EDOCR2_WORKERS=2
EDGNET_WORKERS=2
SKINMODEL_WORKERS=2
VL_API_WORKERS=2
YOLO_WORKERS=1
PADDLEOCR_WORKERS=1

# Request timeout in seconds
REQUEST_TIMEOUT=120

# ============================================================================
# CORS Configuration
# ============================================================================

# Allowed origins for CORS (comma-separated)
CORS_ORIGINS=http://localhost:5173,http://localhost:3000

# ============================================================================
# GPU Configuration
# ============================================================================

# Enable GPU usage for YOLO, EDGNet, eDOCr2, PaddleOCR
USE_GPU=true

# CUDA device ID (0, 1, 2, etc.)
CUDA_DEVICE=0

# NVIDIA visible devices (all, 0, 1, ...)
NVIDIA_VISIBLE_DEVICES=all

# ============================================================================
# VL (Vision-Language) Configuration
# ============================================================================

# VL Provider (openai, anthropic)
VL_PROVIDER=openai

# VL Model (gpt-4o-mini, claude-3-haiku-20240307, etc.)
VL_MODEL=gpt-4o-mini

# VL Parameters
VL_MAX_TOKENS=1000
VL_TEMPERATURE=0.1

# ============================================================================
# OCR Configuration
# ============================================================================

# PaddleOCR Settings
OCR_LANG=en
OCR_VERSION=PP-OCRv5
USE_ANGLE_CLS=true
TEXT_DET_THRESH=0.3
TEXT_DET_BOX_THRESH=0.6

# Surya OCR Settings
USE_DOC_ORIENTATION=false
USE_DOC_UNWARPING=false
USE_TEXTLINE_ORIENTATION=true

# ============================================================================
# Caching Configuration
# ============================================================================

# Enable caching
ENABLE_CACHING=false

# Cache TTL in seconds
CACHE_TTL=3600

# ============================================================================
# Usage Examples
# ============================================================================

# Development (minimal setup):
#   ANTHROPIC_API_KEY=sk-ant-...
#   OPENAI_API_KEY=sk-...
#   ENABLE_AUTH=false
#   ENABLE_RATE_LIMIT=false
#   USE_GPU=true

# Production (with security):
#   ANTHROPIC_API_KEY=sk-ant-...
#   OPENAI_API_KEY=sk-...
#   ENABLE_AUTH=true
#   API_KEY=<strong-random-key>
#   ENABLE_RATE_LIMIT=true
#   RATE_LIMIT_PER_MINUTE=30
#   RATE_LIMIT_PER_HOUR=500

# Testing (permissive rate limits):
#   ENABLE_RATE_LIMIT=true
#   RATE_LIMIT_PER_MINUTE=100
#   RATE_LIMIT_PER_HOUR=5000

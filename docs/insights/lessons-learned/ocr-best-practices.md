# OCR 파이프라인 베스트 프랙티스

- **최종 업데이트**: 2024-12-09
- **카테고리**: lessons-learned
- **태그**: `ocr`, `best-practices`, `pipeline`

---

## 1. 전처리 가이드라인

### 업스케일링 (ESRGAN)

| 원본 해상도 | 권장 스케일 | 비고 |
|------------|------------|------|
| < 500px | 4x | 저해상도 스캔 |
| 500-1000px | 2x | 일반 스캔 |
| > 1000px | 1x (생략) | 고해상도 |

**주의사항**:
- 4x 업스케일 시 처리 시간 ~5배 증가
- 노이즈 증폭으로 오인식률 증가 가능
- GPU VRAM 4GB+ 필요

### 이미지 품질 체크
- 기울기 보정 필요 여부
- 노이즈 레벨 확인
- 대비(Contrast) 충분한지

---

## 2. OCR 엔진 선택 가이드

### 용도별 권장 엔진

| 용도 | 1순위 | 2순위 | 비고 |
|------|-------|-------|------|
| 기계 도면 치수 | eDOCr2 | PaddleOCR | 한국어 특화 |
| 일반 텍스트 | EasyOCR | Tesseract | 범용성 |
| 손글씨 | TrOCR | Surya OCR | Transformer 기반 |
| 고정밀 필요 | OCR Ensemble | - | 4엔진 투표 |

### OCR Ensemble 가중치 (기본값)
```yaml
eDOCr2: 0.40      # 도면 특화
PaddleOCR: 0.35   # 범용 + 한글
Tesseract: 0.15   # 보조
TrOCR: 0.10       # 보조
```

---

## 3. 후처리 체크리스트

### 필수 검증
- [ ] 치수 패턴 정규식 매칭
- [ ] 신뢰도 임계값 필터 (≥ 0.7 권장)
- [ ] 중복 검출 제거

### 권장 검증
- [ ] 물리적 타당성 검사 (음수, 극단값 제거)
- [ ] 단위 일관성 확인 (mm, cm, m)
- [ ] 공차 표기 파싱 (±, +/-)

### 치수 정규식 예시
```javascript
// 기본 치수
/(\d+\.?\d*)\s*(mm|cm|m)?/

// 직경
/[⌀Φφ]?\s*(\d+\.?\d*)/

// 공차 포함
/(\d+\.?\d*)\s*([+-]?\d+\.?\d*)?/
```

---

## 4. 파이프라인 패턴

### 패턴 A: 빠른 분석 (단일 엔진)
```
ImageInput → eDOCr2 → 후처리
```
- 처리 시간: ~10초
- 정확도: 중간
- 용도: 빠른 미리보기

### 패턴 B: 표준 분석 (전처리 + 단일)
```
ImageInput → ESRGAN(2x) → eDOCr2 → 후처리
```
- 처리 시간: ~60초
- 정확도: 높음
- 용도: 일반 도면 분석

### 패턴 C: 고정밀 분석 (전처리 + 앙상블)
```
ImageInput → ESRGAN(2x) → OCR Ensemble → 후처리
```
- 처리 시간: ~180초
- 정확도: 최고
- 용도: 품질 중요 시

---

## 5. 흔한 오류와 해결책

### 오류 1: 숫자가 기호로 인식
```
증상: 85 → :5, 47 → 4)
원인: 저해상도, 노이즈
해결: 전처리 강화, 신뢰도 필터
```

### 오류 2: 단위 누락
```
증상: 85mm → 85
원인: 단위 영역 검출 실패
해결: 후처리에서 단위 추정/추가
```

### 오류 3: 중복 검출
```
증상: 동일 치수가 여러 번 검출
원인: 앙상블 병합 미흡
해결: NMS(Non-Maximum Suppression) 적용
```

---

## 6. 성능 최적화 팁

### GPU 활용
- ESRGAN: GPU 필수 (CPU 20배 느림)
- OCR 엔진: GPU 권장 (CPU 3-10배 느림)

### 배치 처리
- 여러 이미지 처리 시 배치 모드 활용
- 메모리 vs 속도 트레이드오프 고려

### 캐싱
- 동일 이미지 재처리 방지
- 전처리 결과 캐싱 고려

---

## 참고 벤치마크

- [ESRGAN-OCR 전처리 벤치마크](../benchmarks/2024-12-09_esrgan-ocr-preprocessing.md)

---

*이 문서는 실제 운영 경험을 바탕으로 지속적으로 업데이트됩니다.*

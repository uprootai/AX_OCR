# ESRGAN 전처리가 OCR 정확도에 미치는 영향

- **날짜**: 2024-12-09
- **작성자**: AX Team (Claude Code)
- **카테고리**: benchmark
- **태그**: `esrgan`, `edocr2`, `preprocessing`, `upscaling`

---

## 개요

ESRGAN 이미지 업스케일링이 eDOCr2 OCR 성능에 미치는 영향을 측정하기 위한 벤치마크 테스트.
동일 이미지에 대해 원본, 2x 업스케일, 4x 업스케일 후 OCR 결과를 비교.

## 테스트 환경

### 입력 이미지
- **파일명**: `sample2_interm_shaft.jpg`
- **내용**: 중간축(Intermediate Shaft) 기계 도면
- **특징**: 치수선, 공차 정보, 한글/영문 혼합 텍스트

### 파이프라인 구성
```
ImageInput → eDOCr2(원본) → ESRGAN(2x) → eDOCr2(2x) → ESRGAN(4x) → eDOCr2(4x) → Merge
```

### 실행 모드
- **모드**: Sequential (순차 실행)
- **총 노드**: 7개
- **총 실행 시간**: 512.79초

---

## 정량적 결과

### 치수 검출 수 비교

| 단계 | 검출 수 | linear | text_dimension | 증가율 |
|------|---------|--------|----------------|--------|
| 원본 | 15 | 12 | 3 | - |
| 2x 업스케일 | 28 | 22 | 6 | +87% |
| 4x 업스케일 | 40 | 32 | 8 | +167% |

### 실행 시간 (추정)
- 원본 OCR: ~10초
- ESRGAN 2x + OCR: ~150초
- ESRGAN 4x + OCR: ~350초

---

## 품질 분석

### 정상 검출 사례 (4x 기준)
```
85mm, 74.5mm, 47mm, 30mm, 22.5mm, 37mm, 169mm
⌀392mm, ⌀472mm, ⌀328mm, ⌀361mm, ⌀318mm, ⌀382mm
```

### 오인식 사례 (4x 기준)
```
:9, (2::9:), 9 :B, ()45:, :):0          # 숫자→기호 오인식
⌀.386, ⌀/4// A 7, 7)±±                  # 노이즈/왜곡
A"A)01+, 1mmmm, Z0:                      # 비정상 패턴
```

### 유효 검출 비율

| 단계 | 검출 수 | 추정 유효 | 유효율 |
|------|---------|----------|--------|
| 원본 | 15 | ~8 | ~53% |
| 2x | 28 | ~15 | ~54% |
| 4x | 40 | ~16 | ~40% |

**관찰**: 4x에서 검출 수는 최대이나, 오인식 비율도 함께 증가

---

## 핵심 인사이트

### 1. 전처리 효과의 양면성
> "업스케일링은 검출 **양**을 늘리지만, **질**을 보장하지 않는다"

- 저해상도 영역의 텍스트 검출 향상
- 동시에 노이즈도 증폭되어 오인식 증가

### 2. 최적 업스케일 배율
- **2x 권장**: 검출 수 증가 + 합리적인 오인식률
- **4x 주의**: 검출 최대화 필요 시에만 사용, 후처리 필수

### 3. 후처리 필요성
- 현재 OCR 결과를 그대로 사용하기 어려움
- 정규식 기반 검증, 신뢰도 필터링 필수

---

## 권장 사항

### 단기 개선
1. **OCR Ensemble 적용**: 4개 엔진 가중 투표로 오인식 필터링
2. **신뢰도 임계값 상향**: confidence ≥ 0.7 필터
3. **패턴 검증 추가**: 치수 정규식 `/\d+\.?\d*(mm|cm|m)?/`

### 중기 개선
1. **eDOCr2 파인튜닝**: 기계 도면 데이터셋으로 재학습
2. **도메인 특화 후처리**: 비현실적 값 필터링 (음수, 극단값)

### 파이프라인 권장 구성
```
ImageInput → ESRGAN(2x) → OCR Ensemble → 후처리 검증 → 결과
```

---

## 후속 실험 제안

| 실험 | 목적 | 예상 기간 |
|------|------|----------|
| OCR Ensemble 비교 | 앙상블 vs 단일 엔진 | 1일 |
| 신뢰도 임계값 탐색 | 최적 confidence 찾기 | 0.5일 |
| PaddleOCR 단독 테스트 | 엔진별 성능 비교 | 0.5일 |

---

## 참고 자료

- [Real-ESRGAN 논문](../papers/07_ESRGAN_preprocessing.md)
- [eDOCr2 API 문서](../api/edocr2/README.md)

---

*이 문서는 BlueprintFlow 실행 결과를 바탕으로 자동 생성되었습니다.*

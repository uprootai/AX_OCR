<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AX Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            margin-top: 5px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #ccc;
        }

        .status-item.healthy {
            border-left-color: #10b981;
        }

        .status-item.unhealthy {
            border-left-color: #ef4444;
        }

        .status-item.error {
            border-left-color: #f59e0b;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-box {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .log-viewer {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .model-list {
            list-style: none;
        }

        .model-item {
            padding: 12px;
            background: #f8f9fa;
            margin: 8px 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 6px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        .gpu-gauge {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üöÄ AX Admin Dashboard</h1>
            <p>ÌÜµÌï© Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú - Î™®Îì† API, Î™®Îç∏, GPUÎ•º Ìïú Í≥≥ÏóêÏÑú Í¥ÄÎ¶¨</p>
        </div>
    </div>

    <div class="container">
        <!-- System Overview -->
        <div class="grid">
            <!-- API Status -->
            <div class="card">
                <h2>üì° API ÏÉÅÌÉú</h2>
                <div id="api-status">
                    <div class="loading" style="margin: 20px auto;"></div>
                </div>
            </div>

            <!-- GPU Status -->
            <div class="card">
                <h2>üéÆ GPU ÏÉÅÌÉú</h2>
                <div id="gpu-status">
                    <div class="loading" style="margin: 20px auto;"></div>
                </div>
            </div>

            <!-- System Stats -->
            <div class="card">
                <h2>üíª ÏãúÏä§ÌÖú Î¶¨ÏÜåÏä§</h2>
                <div id="system-stats">
                    <div class="loading" style="margin: 20px auto;"></div>
                </div>
            </div>
        </div>

        <!-- Main Tabs -->
        <div class="card">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('models')">Î™®Îç∏ Í¥ÄÎ¶¨</div>
                <div class="tab" onclick="switchTab('training')">ÌïôÏäµ</div>
                <div class="tab" onclick="switchTab('inference')">Ï∂îÎ°† ÌÖåÏä§Ìä∏</div>
                <div class="tab" onclick="switchTab('logs')">Î°úÍ∑∏</div>
                <div class="tab" onclick="switchTab('docker')">Docker Í¥ÄÎ¶¨</div>
            </div>

            <!-- Models Tab -->
            <div id="tab-models" class="tab-content active">
                <h2>Î™®Îç∏ ÌååÏùº Í¥ÄÎ¶¨</h2>
                <div style="margin: 20px 0;">
                    <select id="model-type-select" onchange="loadModels()" class="btn">
                        <option value="skinmodel">Skin Model</option>
                        <option value="edgnet">EDGNet</option>
                        <option value="yolo">YOLO</option>
                    </select>
                </div>
                <ul id="model-list" class="model-list">
                    <li>Loading...</li>
                </ul>
            </div>

            <!-- Training Tab -->
            <div id="tab-training" class="tab-content">
                <h2>Î™®Îç∏ ÌïôÏäµ</h2>
                <div style="margin: 20px 0;">
                    <button class="btn btn-primary" onclick="trainModel('skinmodel')">Skin Model ÌïôÏäµ</button>
                    <button class="btn btn-primary" onclick="trainModel('edgnet')">EDGNet ÌïôÏäµ</button>
                </div>
                <div id="training-output"></div>
            </div>

            <!-- Inference Tab -->
            <div id="tab-inference" class="tab-content">
                <h2>Ï∂îÎ°† ÌÖåÏä§Ìä∏</h2>
                <div style="margin: 20px 0;">
                    <select id="inference-api-select" class="btn">
                        <option value="yolo">YOLO</option>
                        <option value="edocr2">eDOCr2</option>
                        <option value="skinmodel">Skin Model</option>
                    </select>
                </div>
                <div class="file-upload" onclick="document.getElementById('file-input').click()">
                    <p>üìÅ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</p>
                    <input type="file" id="file-input" style="display: none;" onchange="testInference()">
                </div>
                <div id="inference-result"></div>
            </div>

            <!-- Logs Tab -->
            <div id="tab-logs" class="tab-content">
                <h2>ÏÑúÎπÑÏä§ Î°úÍ∑∏</h2>
                <div style="margin: 20px 0;">
                    <select id="log-service-select" onchange="loadLogs()" class="btn">
                        <option value="edocr2-api">eDOCr2</option>
                        <option value="edgnet-api">EDGNet</option>
                        <option value="skinmodel-api">Skin Model</option>
                        <option value="yolo-api">YOLO</option>
                        <option value="gateway-api">Gateway</option>
                    </select>
                    <button class="btn btn-success" onclick="loadLogs()">üîÑ ÏÉàÎ°úÍ≥†Ïπ®</button>
                </div>
                <div id="log-viewer" class="log-viewer">
                    Loading logs...
                </div>
            </div>

            <!-- Docker Tab -->
            <div id="tab-docker" class="tab-content">
                <h2>Docker Ïª®ÌÖåÏù¥ÎÑà Í¥ÄÎ¶¨</h2>
                <div class="grid">
                    <div class="stat-box">
                        <button class="btn btn-success" onclick="dockerAction('start', 'edocr2-api')">Start eDOCr2</button>
                        <button class="btn btn-danger" onclick="dockerAction('stop', 'edocr2-api')">Stop</button>
                        <button class="btn btn-primary" onclick="dockerAction('restart', 'edocr2-api')">Restart</button>
                    </div>
                    <div class="stat-box">
                        <button class="btn btn-success" onclick="dockerAction('start', 'skinmodel-api')">Start Skin Model</button>
                        <button class="btn btn-danger" onclick="dockerAction('stop', 'skinmodel-api')">Stop</button>
                        <button class="btn btn-primary" onclick="dockerAction('restart', 'skinmodel-api')">Restart</button>
                    </div>
                    <div class="stat-box">
                        <button class="btn btn-success" onclick="dockerAction('start', 'yolo-api')">Start YOLO</button>
                        <button class="btn btn-danger" onclick="dockerAction('stop', 'yolo-api')">Stop</button>
                        <button class="btn btn-primary" onclick="dockerAction('restart', 'yolo-api')">Restart</button>
                    </div>
                    <div class="stat-box">
                        <button class="btn btn-success" onclick="dockerAction('start', 'gateway-api')">Start Gateway</button>
                        <button class="btn btn-danger" onclick="dockerAction('stop', 'gateway-api')">Stop</button>
                        <button class="btn btn-primary" onclick="dockerAction('restart', 'gateway-api')">Restart</button>
                    </div>
                </div>
                <div id="docker-output"></div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById('tab-' + tabName).classList.add('active');

            if (tabName === 'models') loadModels();
            if (tabName === 'logs') loadLogs();
        }

        // Load system status
        async function loadStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();

                // Update API status
                const apiHTML = data.apis.map(api => `
                    <div class="status-item ${api.status}">
                        <div>
                            <strong>${api.name.toUpperCase()}</strong>
                            <div style="font-size: 12px; color: #6b7280;">${api.url}</div>
                        </div>
                        <span class="badge ${api.status === 'healthy' ? 'success' : 'danger'}">
                            ${api.status}
                        </span>
                    </div>
                `).join('');
                document.getElementById('api-status').innerHTML = apiHTML;

                // Update GPU status
                const gpu = data.gpu;
                let gpuHTML = '';
                if (gpu.available) {
                    const usedPercent = (gpu.used_memory / gpu.total_memory * 100).toFixed(1);
                    gpuHTML = `
                        <div class="stat-box">
                            <div class="stat-label">${gpu.device_name}</div>
                            <div class="stat-value">${usedPercent}%</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${usedPercent}%"></div>
                            </div>
                            <div style="font-size: 12px; margin-top: 10px;">
                                ${gpu.used_memory} MB / ${gpu.total_memory} MB
                            </div>
                        </div>
                    `;
                } else {
                    gpuHTML = '<div class="alert alert-error">GPU not available</div>';
                }
                document.getElementById('gpu-status').innerHTML = gpuHTML;

                // Update system stats
                const sysHTML = `
                    <div class="stat-grid">
                        <div class="stat-box">
                            <div class="stat-value">${data.system.cpu_percent.toFixed(1)}%</div>
                            <div class="stat-label">CPU</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${data.system.memory_percent.toFixed(1)}%</div>
                            <div class="stat-label">Memory</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value">${data.system.disk_percent.toFixed(1)}%</div>
                            <div class="stat-label">Disk</div>
                        </div>
                    </div>
                `;
                document.getElementById('system-stats').innerHTML = sysHTML;

            } catch (error) {
                console.error('Error loading status:', error);
            }
        }

        // Load models
        async function loadModels() {
            const modelType = document.getElementById('model-type-select').value;
            try {
                const response = await fetch(`/api/models/${modelType}`);
                const data = await response.json();

                const html = data.models.map(model => `
                    <li class="model-item">
                        <div>
                            <strong>${model.name}</strong>
                            <div style="font-size: 12px; color: #6b7280;">
                                ${(model.size / 1024 / 1024).toFixed(2)} MB | ${new Date(model.modified).toLocaleString()}
                            </div>
                        </div>
                        <button class="btn btn-primary btn-sm">Download</button>
                    </li>
                `).join('');

                document.getElementById('model-list').innerHTML = html || '<li>No models found</li>';
            } catch (error) {
                document.getElementById('model-list').innerHTML = '<li class="alert alert-error">Error loading models</li>';
            }
        }

        // Train model
        async function trainModel(modelType) {
            const output = document.getElementById('training-output');
            output.innerHTML = '<div class="alert alert-success">ÌïôÏäµ ÏãúÏûë Ï§ë... <div class="loading"></div></div>';

            try {
                const response = await fetch(`/api/train/${modelType}`, { method: 'POST' });
                const data = await response.json();

                if (data.status === 'completed') {
                    output.innerHTML = `
                        <div class="alert alert-success">‚úÖ ÌïôÏäµ ÏôÑÎ£å!</div>
                        <div class="log-viewer">${data.stdout}</div>
                    `;
                } else {
                    output.innerHTML = `
                        <div class="alert alert-error">‚ùå ÌïôÏäµ Ïã§Ìå®</div>
                        <div class="log-viewer">${data.stderr || data.stdout}</div>
                    `;
                }
            } catch (error) {
                output.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }

        // Test inference
        async function testInference() {
            const fileInput = document.getElementById('file-input');
            const apiSelect = document.getElementById('inference-api-select');
            const resultDiv = document.getElementById('inference-result');

            if (!fileInput.files.length) return;

            resultDiv.innerHTML = '<div class="alert alert-success">Ï∂îÎ°† Ïã§Ìñâ Ï§ë... <div class="loading"></div></div>';

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch(`/api/inference/${apiSelect.value}`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                resultDiv.innerHTML = `
                    <div class="alert alert-success">‚úÖ Ï∂îÎ°† ÏôÑÎ£å</div>
                    <div class="log-viewer">${JSON.stringify(data, null, 2)}</div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }

        // Load logs
        async function loadLogs() {
            const service = document.getElementById('log-service-select').value;
            const logViewer = document.getElementById('log-viewer');

            logViewer.innerHTML = 'Loading logs...';

            try {
                const response = await fetch(`/api/logs/${service}?lines=200`);
                const data = await response.json();
                logViewer.innerHTML = data.logs || 'No logs available';
            } catch (error) {
                logViewer.innerHTML = `Error: ${error.message}`;
            }
        }

        // Docker actions
        async function dockerAction(action, service) {
            const output = document.getElementById('docker-output');
            output.innerHTML = `<div class="alert alert-success">Ïã§Ìñâ Ï§ë... <div class="loading"></div></div>`;

            try {
                const response = await fetch(`/api/docker/${action}/${service}`, { method: 'POST' });
                const data = await response.json();

                if (data.status === 'success') {
                    output.innerHTML = `
                        <div class="alert alert-success">‚úÖ ${action} ${service} ÏôÑÎ£å</div>
                        <div class="log-viewer">${data.output}</div>
                    `;
                } else {
                    output.innerHTML = `
                        <div class="alert alert-error">‚ùå ${action} ${service} Ïã§Ìå®</div>
                        <div class="log-viewer">${data.error || data.output}</div>
                    `;
                }

                // Reload status
                setTimeout(loadStatus, 2000);
            } catch (error) {
                output.innerHTML = `<div class="alert alert-error">Error: ${error.message}</div>`;
            }
        }

        // Auto-refresh
        setInterval(loadStatus, 5000);

        // Initial load
        loadStatus();
        loadModels();
    </script>
</body>
</html>

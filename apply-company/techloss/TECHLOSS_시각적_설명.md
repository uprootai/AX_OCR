# TECHCROSS P&ID AI 검토 시스템 - 시각적 설명

> **작성일**: 2025.12.25
> **목적**: AX POC 시스템과 TECHCROSS 요구사항의 시각적 매핑

---

## 1. 전체 시스템 아키텍처

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                    TECHCROSS P&ID AI 검토 시스템                      ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                                    │
        ┌───────────────────────────┼───────────────────────────┐
        ▼                           ▼                           ▼
┌───────────────┐          ┌───────────────┐          ┌───────────────┐
│   📄 입력      │          │   🔍 분석      │          │   📊 출력      │
├───────────────┤          ├───────────────┤          ├───────────────┤
│ • P&ID (PDF)  │    →     │ • 심볼 검출    │    →     │ • 체크리스트  │
│ • P&ID (DWG)  │          │ • 라인 검출    │          │ • Valve List  │
│ • POS 문서    │          │ • 텍스트 OCR   │          │ • Equip List  │
│ • 선급 RULE   │          │ • 연결성 분석  │          │ • Deviation   │
└───────────────┘          └───────────────┘          └───────────────┘
```

---

## 2. AX POC 노드 파이프라인

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      BlueprintFlow 파이프라인                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────┐                                                          │
│  │ 📷 P&ID  │                                                          │
│  │   PDF    │                                                          │
│  └────┬─────┘                                                          │
│       │                                                                 │
│       ▼                                                                 │
│  ┌──────────┐     ┌───────────────────────────────────────────┐        │
│  │  ESRGAN  │────▶│              YOLO (pid_symbol)            │        │
│  │ 업스케일  │     │  • 60종 P&ID 심볼 검출                    │        │
│  │ (선택적)  │     │  • SAHI 슬라이싱 (대형 도면)              │        │
│  └──────────┘     │  • 검출: 밸브, 계기, 장비, 배관요소         │        │
│                   └─────────────────┬─────────────────────────┘        │
│                                     │                                   │
│  ┌──────────────────┐              │                                   │
│  │  Line Detector   │──────────────┼──────┐                            │
│  │  • 배관 라인     │              │      │                            │
│  │  • 신호선        │              │      ▼                            │
│  │  • 색상별 분류   │         ┌────┴──────────────┐                    │
│  └──────────────────┘         │   PID Analyzer    │                    │
│                               │  ┌──────────────┐ │                    │
│  ┌──────────────────┐         │  │연결성 그래프 │ │                    │
│  │  OCR Ensemble    │────────▶│  │Valve List    │ │                    │
│  │  • eDOCr2 (40%)  │         │  │Equipment List│ │                    │
│  │  • Paddle (35%)  │         │  │BOM 생성      │ │                    │
│  │  • Tesseract(15%)│         │  └──────────────┘ │                    │
│  │  • TrOCR (10%)   │         └────────┬──────────┘                    │
│  └──────────────────┘                  │                               │
│                                        ▼                               │
│                          ┌─────────────────────────┐                   │
│                          │    Design Checker       │                   │
│                          │  ┌───────────────────┐  │                   │
│                          │  │ ✅ 체크리스트 검토 │  │                   │
│                          │  │ ⚠️ Deviation 식별  │  │                   │
│                          │  │ ❌ 규정 위반 표시  │  │                   │
│                          │  └───────────────────┘  │                   │
│                          └─────────────────────────┘                   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3. P&ID 심볼 검출 대상

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        검출 대상 심볼 (50+ 종)                          │
├──────────────────┬──────────────────┬───────────────────────────────────┤
│     밸브류       │     계기류       │           장비류                  │
├──────────────────┼──────────────────┼───────────────────────────────────┤
│                  │                  │                                   │
│  ◁━▷ Butterfly   │  [PI] Pressure   │  ⬡ ECU (전해조)                  │
│  ⊠◁▷ Remote BFV  │  [PS] P.Switch   │  ⬡ HGU (차아염소산)              │
│  ⊳| Globe        │  [TI] Temp.Ind   │  ⬡ DMU (탈기모듈)                │
│  ⊳◇ Check        │  [TS] T.Switch   │  ⬡ ANU/NIU (중화)               │
│  ⊠ Ball          │  [LS] Level      │  ⬡ TSU/DTS (TRO센서)            │
│  ◁|▷ Diaphragm   │  [ZS] Limit      │  ⬡ FMU (유량계)                  │
│  ⌐▷ Angle        │  [PT] P.Trans    │  ⬡ GDS (가스감지)               │
│  ⊗◁▷ Solenoid    │  [FS] Flow       │  ⬡ EWU (전극세척)               │
│  ⊳|▷ Throttle    │  [GS] Gas        │  ⊙M Pump                        │
│  ⊠3 3-Way        │  [CI] Compound   │  ⊠⊠ Strainer                    │
│                  │                  │  ★ Maker Supply                  │
└──────────────────┴──────────────────┴───────────────────────────────────┘
```

---

## 4. ECS vs HYCHLOR 시스템 비교

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     ECS (직접 전기분해)                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│    Sea Water ──▶ [ECU 전해조] ──▶ 처리수 ──▶ Ballast Tank              │
│                      │                                                  │
│                      ▼                                                  │
│                  직접 전기분해                                           │
│                  (필터 없음)                                             │
│                                                                         │
│    구성: ECU, PRU, ANU, TSU, APU, FMU, CSU, GDS, EWU                    │
│    복잡도: ★★☆☆☆                                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                   HYCHLOR 2.0 (간접 전기분해)                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│    Sea Water ─┬─▶ [Main Line] ────────────────────▶ Ballast Tank       │
│               │                         ▲                               │
│               │                         │ 약품 주입                     │
│               └─▶ [Side Stream] ──▶ [HGU] ──▶ [DMU]                    │
│                   (Feeder Pump)     차아염소산    탈기                   │
│                                       생성                              │
│                                                                         │
│    추가: MCP, MPC, MCC, HGU, PRM, DMU, FP, NIU, DTS, DTU, SWH          │
│    복잡도: ★★★★☆                                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 5. 체크리스트 자동 검토 항목

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      자동 검토 가능 항목                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ✅ 검출 기반 검토 (YOLO + OCR)                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ • FMU가 ECU 후단에 위치하는가?                                   │   │
│  │ • GDS가 ECU/HGU 상부에 위치하는가?                               │   │
│  │ • T-STR 적용 여부 확인                                          │   │
│  │ • SIGNAL FOR BWMS 밸브 추출                                     │   │
│  │ • Maker Supply (★) 장비 목록 추출                               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ⚠️ 거리/위치 기반 검토 (PID Analyzer)                                  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ • TSU Port와 ANU Port 간 최소 5D 거리                           │   │
│  │ • G-2 Sampling Port upstream 위치                               │   │
│  │ • ANU/NIU Injection Port 10m 이내                               │   │
│  │ • EWU 담수 라인 ECU 주변 3m 이내                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  📊 계산 기반 검토 (OCR + 규칙)                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ • Mixing Pump 용량 = Ballast Pump × 4.3%                        │   │
│  │ • 배관 유속 3m/s 기준 사이즈 적정성                               │   │
│  │ • 냉각수 유량 0.45m³/h (PRU당) 확인                              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 출력물 구조

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         AI 검토 결과 출력물                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  📋 체크리스트 검토 결과                                                 │
│  ┌────┬────────────────────────────────┬────────┬──────────────────┐   │
│  │ No │ 체크 항목                       │  판정  │      비고        │   │
│  ├────┼────────────────────────────────┼────────┼──────────────────┤   │
│  │  1 │ FMU가 ECU 후단에 위치           │   ✅   │                  │   │
│  │  2 │ FMU Down sizing 적용            │   ❌   │ 메인배관과 동일  │   │
│  │  3 │ ANU 적정 용량 적용              │   ✅   │ 5T 모델 적정     │   │
│  │  4 │ G-2 Sampling upstream 위치      │   ✅   │                  │   │
│  └────┴────────────────────────────────┴────────┴──────────────────┘   │
│                                                                         │
│  📋 Valve Signal List                                                   │
│  ┌────────┬────────────────────┬────────────┬────────────────────┐     │
│  │ 밸브ID │       역할         │  N.O/N.C   │     알람조건       │     │
│  ├────────┼────────────────────┼────────────┼────────────────────┤     │
│  │ BAV1   │ Ballast Pump #1    │    N.C     │ SIGNAL FOR BWMS    │     │
│  │ BWV2   │ BWMS Inlet         │    N.O     │ SIGNAL FOR BWMS    │     │
│  └────────┴────────────────────┴────────────┴────────────────────┘     │
│                                                                         │
│  📋 Equipment List                                                      │
│  ┌────────┬────────────────────────┬────────┬─────────────────────┐    │
│  │ 장비ID │         명칭           │  수량  │       사양          │    │
│  ├────────┼────────────────────────┼────────┼─────────────────────┤    │
│  │ ECU    │ Electro Chamber Unit   │   1    │ 1000B               │    │
│  │ PRU    │ Power Rectifier Unit   │   1    │ 12A                 │    │
│  │ ANU    │ Auto Neutralization    │   1    │ 5T                  │    │
│  └────────┴────────────────────────┴────────┴─────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 개발 로드맵 타임라인

```
2026 Q1                Q2                Q3                Q4
────┬─────────────────┬─────────────────┬─────────────────┬────
    │                 │                 │                 │
    │  ┌───────────┐  │                 │                 │
    │  │ Phase 1   │  │                 │                 │
    │  │ POC 구축  │──┼──┐              │                 │
    │  │ (1-2주)   │  │  │              │                 │
    │  └───────────┘  │  │              │                 │
    │                 │  ▼              │                 │
    │                 │ ┌───────────┐   │                 │
    │                 │ │ Phase 2   │   │                 │
    │                 │ │ YOLO 학습 │───┼──┐              │
    │                 │ │ (3-4주)   │   │  │              │
    │                 │ └───────────┘   │  │              │
    │                 │                 │  ▼              │
    │                 │                 │ ┌───────────┐   │
    │                 │                 │ │ Phase 3   │   │
    │                 │                 │ │ 체크리스트│───┼──┐
    │                 │                 │ │ (2-3주)   │   │  │
    │                 │                 │ └───────────┘   │  │
    │                 │                 │                 │  ▼
    │                 │                 │                 │ ┌─────────┐
    │                 │                 │                 │ │Phase4+5 │
    │                 │                 │                 │ │출력/납품│
    │                 │                 │                 │ │(3-4주)  │
    │                 │                 │                 │ └─────────┘
────┴─────────────────┴─────────────────┴─────────────────┴────
```

---

## 8. 샘플 이미지 현황

| 유형 | 파일 | 활용 방안 |
|------|------|----------|
| **P&ID PDF** | ECS/HYCHLOR 각 1건 | YOLO 테스트, 학습 데이터 |
| **DWG 원본** | ECS/HYCHLOR 각 1건 | 고해상도 변환 후 활용 |
| **별도 이미지** | ❌ 없음 | PDF에서 페이지별 추출 필요 |

### PDF에서 테스트 이미지 추출 방법
```bash
# PDF를 PNG로 변환
pdftoppm -png -r 300 "[PNID] REV.0 YZJ2023...pdf" output_prefix

# 또는 ImageMagick 사용
convert -density 300 "[PNID] REV.0 YZJ2023...pdf" output.png
```

---

*문서 작성: Claude Code (Opus 4.5)*

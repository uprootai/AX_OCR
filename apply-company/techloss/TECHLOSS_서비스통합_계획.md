# TECHCROSS BWMS - AX 서비스 통합 계획

> 작성일: 2025-12-25
> 목적: TECHCROSS P&ID 분석 기능을 AX POC 시스템에 통합하는 전체 설계

---

## 1. 현재 AX 시스템 아키텍처

### 1.1 기존 시스템 구조
```
┌─────────────────────────────────────────────────────────────────────────┐
│                          AX POC 현재 시스템                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────┐     ┌─────────────────────────────────────────────┐   │
│  │   Web UI    │────▶│              Gateway API (:8000)            │   │
│  │  (:5173)    │     │         - BlueprintFlow 파이프라인           │   │
│  └─────────────┘     │         - 실행 오케스트레이션                 │   │
│                      └────────────────────┬────────────────────────┘   │
│                                           │                             │
│            ┌──────────────────────────────┼──────────────────────────┐ │
│            ▼                              ▼                          ▼ │
│  ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────────┐  │
│  │  Detection      │   │  OCR            │   │  Analysis           │  │
│  │  ─────────────  │   │  ─────────────  │   │  ─────────────────  │  │
│  │  YOLO (:5005)   │   │  eDOCr2 (:5002) │   │  PID Analyzer       │  │
│  │  YOLO-PID       │   │  PaddleOCR      │   │    (:5018)          │  │
│  │    (:5017)      │   │    (:5006)      │   │  Design Checker     │  │
│  │  Line Detector  │   │  OCR Ensemble   │   │    (:5019)          │  │
│  │    (:5016)      │   │    (:5011)      │   │  Blueprint AI BOM   │  │
│  └─────────────────┘   └─────────────────┘   │    (:5020)          │  │
│                                              └─────────────────────┘  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.2 현재 BlueprintFlow 노드 체계
```
┌───────────────────────────────────────────────────────────────┐
│                  현재 BlueprintFlow 노드 (21개)               │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│  Input          Detection        OCR           Analysis       │
│  ┌─────────┐   ┌──────────┐   ┌──────────┐   ┌────────────┐  │
│  │ Image   │   │ YOLO     │   │ eDOCr2   │   │ SkinModel  │  │
│  │ Input   │   │ YOLO-PID │   │ PaddleOCR│   │ PID Analyz.│  │
│  │ Text    │   │ Line Det.│   │ Tesseract│   │ Design Chk │  │
│  │ Input   │   │ EDGNet   │   │ TrOCR    │   │ Blueprint  │  │
│  └─────────┘   └──────────┘   │ Ensemble │   │ AI BOM     │  │
│                               └──────────┘   └────────────┘  │
│                                                               │
│  Control        Preprocessing   Knowledge     AI              │
│  ┌─────────┐   ┌──────────┐   ┌──────────┐   ┌────────────┐  │
│  │ IF      │   │ ESRGAN   │   │ Knowledge│   │ VL         │  │
│  │ Loop    │   │          │   │ (Neo4j)  │   │            │  │
│  │ Merge   │   │          │   │          │   │            │  │
│  └─────────┘   └──────────┘   └──────────┘   └────────────┘  │
│                                                               │
└───────────────────────────────────────────────────────────────┘
```

---

## 2. TECHCROSS 통합 서비스 설계

### 2.1 목표 시스템 아키텍처
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    AX + TECHCROSS 통합 시스템                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐│
│  │                         Web UI (:5173)                                 ││
│  │  ┌──────────────┐  ┌──────────────┐  ┌────────────────────────────┐   ││
│  │  │ BlueprintFlow│  │  Dashboard   │  │   BWMS Checker (NEW)       │   ││
│  │  │ 파이프라인    │  │  모니터링    │  │  ───────────────────────   │   ││
│  │  │ 빌더        │  │              │  │  - P&ID 업로드             │   ││
│  │  └──────────────┘  └──────────────┘  │  - 자동 분석 결과          │   ││
│  │                                      │  - 체크리스트 UI           │   ││
│  │                                      │  - 위반 사항 하이라이트     │   ││
│  │                                      │  - 리포트 생성             │   ││
│  │                                      └────────────────────────────┘   ││
│  └────────────────────────────────────────────────────────────────────────┘│
│                                     │                                       │
│                                     ▼                                       │
│  ┌────────────────────────────────────────────────────────────────────────┐│
│  │                      Gateway API (:8000)                               ││
│  │  ┌─────────────────────────────────────────────────────────────────┐  ││
│  │  │                BWMS Pipeline (NEW)                              │  ││
│  │  │  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────────────┐ │  ││
│  │  │  │ PDF→IMG │──▶│ Symbol  │──▶│ Connect │──▶│ BWMS Rule Check │ │  ││
│  │  │  │ Convert │   │ Detect  │   │ Analyze │   │                 │ │  ││
│  │  │  └─────────┘   └─────────┘   └─────────┘   └─────────────────┘ │  ││
│  │  │       │             │             │               │            │  ││
│  │  │       ▼             ▼             ▼               ▼            │  ││
│  │  │  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────────────┐ │  ││
│  │  │  │ OCR     │   │ Line    │   │ Equipment│   │ Checklist      │ │  ││
│  │  │  │ Extract │   │ Detect  │   │ List Gen │   │ Generator      │ │  ││
│  │  │  └─────────┘   └─────────┘   └─────────┘   └─────────────────┘ │  ││
│  │  └─────────────────────────────────────────────────────────────────┘  ││
│  └────────────────────────────────────────────────────────────────────────┘│
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                        API Services Layer                            │  │
│  │                                                                      │  │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────────┐ │  │
│  │  │  YOLO-PID  │  │    OCR     │  │    PID     │  │ BWMS Checker   │ │  │
│  │  │  Symbol    │  │  Ensemble  │  │  Analyzer  │  │    (NEW)       │ │  │
│  │  │  Detector  │  │            │  │            │  │                │ │  │
│  │  │  (:5017)   │  │  (:5011)   │  │  (:5018)   │  │   (:5021)      │ │  │
│  │  ├────────────┤  ├────────────┤  ├────────────┤  ├────────────────┤ │  │
│  │  │ 30 classes │  │ 4 engines  │  │ Connection │  │ TECHCROSS      │ │  │
│  │  │ + BWMS tag │  │ weighted   │  │ Analysis   │  │ Design Rules   │ │  │
│  │  │ recognition│  │ voting     │  │ BOM Gen    │  │ Checklist Auto │ │  │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────────┘ │  │
│  │                                                                      │  │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐                     │  │
│  │  │   Line     │  │  Design    │  │  Knowledge │                     │  │
│  │  │  Detector  │  │  Checker   │  │   Engine   │                     │  │
│  │  │  (:5016)   │  │  (:5019)   │  │  (:5007)   │                     │  │
│  │  └────────────┘  └────────────┘  └────────────┘                     │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 신규 컴포넌트 상세

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    신규 개발 컴포넌트 (3개)                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  1. BWMS Checker API (:5021) - 신규 API 서비스                        │ │
│  │  ─────────────────────────────────────────────────────────────────    │ │
│  │                                                                       │ │
│  │  입력                                                                 │ │
│  │  ────                                                                 │ │
│  │  • symbols: YOLO-PID 검출 결과                                        │ │
│  │  • connections: PID Analyzer 연결 분석 결과                            │ │
│  │  • ocr_texts: OCR Ensemble 텍스트 결과                                │ │
│  │  • lines: Line Detector 라인 결과                                     │ │
│  │                                                                       │ │
│  │  처리 로직                                                            │ │
│  │  ──────────                                                           │ │
│  │  1. BWMS 장비 태그 인식 (OCR 패턴 매칭)                               │ │
│  │  2. 장비 위치 관계 분석 (upstream/downstream)                         │ │
│  │  3. TECHCROSS 설계 규칙 검증 (9개 규칙)                               │ │
│  │  4. 체크리스트 자동 검증                                              │ │
│  │                                                                       │ │
│  │  출력                                                                 │ │
│  │  ────                                                                 │ │
│  │  • equipment_list: BWMS 장비 목록                                     │ │
│  │  • rule_violations: 규칙 위반 항목                                    │ │
│  │  • checklist: 자동 검증된 체크리스트                                   │ │
│  │  • visualization: 위반 사항 하이라이트 이미지                          │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  2. BWMS Pipeline - Gateway 파이프라인 확장                            │ │
│  │  ─────────────────────────────────────────────────────────────────    │ │
│  │                                                                       │ │
│  │  새로운 Executor 추가: blueprintflow/executors/bwms_executor.py       │ │
│  │  새로운 API Spec: gateway-api/api_specs/bwms-checker.yaml             │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  3. BWMS Checker UI - 전용 프론트엔드 페이지                           │ │
│  │  ─────────────────────────────────────────────────────────────────    │ │
│  │                                                                       │ │
│  │  신규 페이지: web-ui/src/pages/bwms/BWMSChecker.tsx                   │ │
│  │                                                                       │ │
│  │  기능:                                                                │ │
│  │  • P&ID PDF 업로드                                                    │ │
│  │  • 실시간 분석 진행 표시                                               │ │
│  │  • 체크리스트 UI (자동 체크 + 수동 체크)                               │ │
│  │  • 위반 사항 인터랙티브 하이라이트                                     │ │
│  │  • PDF 리포트 생성 및 다운로드                                        │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 사용자 워크플로우 설계

### 3.1 TECHCROSS 엔지니어 워크플로우
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    TECHCROSS P&ID 검토 워크플로우                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  STEP 1: P&ID 업로드                                                        │
│  ━━━━━━━━━━━━━━━━━━                                                         │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │  │
│  │  │                    P&ID 파일 업로드                             │ │  │
│  │  │  ┌─────────────────────────────────────────────────────────┐   │ │  │
│  │  │  │                                                         │   │ │  │
│  │  │  │        📁 드래그 앤 드롭 또는 클릭하여 업로드             │   │ │  │
│  │  │  │                                                         │   │ │  │
│  │  │  │           PDF, PNG, JPG 지원 (최대 50MB)                 │   │ │  │
│  │  │  │                                                         │   │ │  │
│  │  │  └─────────────────────────────────────────────────────────┘   │ │  │
│  │  │                                                                 │ │  │
│  │  │  프로젝트: [YZJ2023-1584     ▼]   시스템: [ECS 1000B  ▼]       │ │  │
│  │  │                                                                 │ │  │
│  │  └─────────────────────────────────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                          │                                  │
│                                          ▼                                  │
│  STEP 2: 자동 분석 진행                                                     │
│  ━━━━━━━━━━━━━━━━━━━━━                                                       │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                      분석 진행 상황                                   │  │
│  │  ┌────────────────────────────────────────────────────────────────┐ │  │
│  │  │ ✅ PDF 변환                          ████████████████████ 100%  │ │  │
│  │  │ ✅ 심볼 검출 (142개)                 ████████████████████ 100%  │ │  │
│  │  │ ✅ 라인 검출 (89개)                  ████████████████████ 100%  │ │  │
│  │  │ ✅ OCR 텍스트 추출 (256개)           ████████████████████ 100%  │ │  │
│  │  │ 🔄 연결 분석 중...                   ████████████░░░░░░░░  65%  │ │  │
│  │  │ ⏳ BWMS 규칙 검증                    ░░░░░░░░░░░░░░░░░░░░   0%  │ │  │
│  │  │ ⏳ 체크리스트 생성                   ░░░░░░░░░░░░░░░░░░░░   0%  │ │  │
│  │  └────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                      │  │
│  │  예상 소요 시간: 약 45초                                              │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                          │                                  │
│                                          ▼                                  │
│  STEP 3: 분석 결과 확인                                                     │
│  ━━━━━━━━━━━━━━━━━━━━                                                        │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                                                                      │  │
│  │  ┌────────────────────────────┐  ┌─────────────────────────────────┐│  │
│  │  │     P&ID 뷰어 (왼쪽)       │  │       분석 결과 (오른쪽)        ││  │
│  │  │  ┌──────────────────────┐  │  │                                 ││  │
│  │  │  │                      │  │  │  요약                           ││  │
│  │  │  │   [P&ID 이미지]      │  │  │  ────                           ││  │
│  │  │  │                      │  │  │  • 검출 심볼: 142개             ││  │
│  │  │  │   위반 사항 빨간색   │  │  │  • BWMS 장비: 8개               ││  │
│  │  │  │   하이라이트         │  │  │  • 규칙 위반: 3건 ⚠️            ││  │
│  │  │  │                      │  │  │  • 체크리스트: 45/60 자동 검증  ││  │
│  │  │  │   클릭하면 해당      │  │  │                                 ││  │
│  │  │  │   위치로 이동        │  │  │  위반 사항                      ││  │
│  │  │  │                      │  │  │  ────────                       ││  │
│  │  │  └──────────────────────┘  │  │  🔴 BWMS-001: G-2 샘플링 포트   ││  │
│  │  │                            │  │     위치 오류 (클릭하여 확인)   ││  │
│  │  │  [확대] [축소] [전체보기]  │  │  🔴 BWMS-004: FMU 위치 오류     ││  │
│  │  │                            │  │  🟡 BWMS-007: 용량 검증 필요    ││  │
│  │  └────────────────────────────┘  │                                 ││  │
│  │                                  └─────────────────────────────────┘│  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                          │                                  │
│                                          ▼                                  │
│  STEP 4: 체크리스트 검토 및 완료                                            │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                                │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                        BWMS 설계 체크리스트                          │  │
│  │  ┌────────────────────────────────────────────────────────────────┐ │  │
│  │  │  Category: 장비 배치 검토                         [12/15 완료] │ │  │
│  │  │  ─────────────────────────────────────────────────────────────  │ │  │
│  │  │  ✅ ECU 용량이 선박 밸러스트 용량에 적합한가?        [자동]    │ │  │
│  │  │  ✅ HGU가 ECU 상부에 위치하는가?                     [자동]    │ │  │
│  │  │  ❌ FMU가 ECU 후단에 위치하는가?                     [자동]    │ │  │
│  │  │      └─ 위반: FMU-001이 ECU-001 전단에 위치함                  │ │  │
│  │  │  ☐ 모든 안전 밸브가 표시되어 있는가?                 [수동]    │ │  │
│  │  │  ☐ 비상 차단 밸브 위치가 적절한가?                   [수동]    │ │  │
│  │  │                                                                │ │  │
│  │  │  Category: 배관 검토                              [8/10 완료]  │ │  │
│  │  │  ─────────────────────────────────────────────────────────────  │ │  │
│  │  │  ✅ G-2 샘플링 포트가 상류에 있는가?                 [자동]    │ │  │
│  │  │  ✅ 최소 5D 거리가 확보되었는가?                     [자동]    │ │  │
│  │  │  ☐ 라인 재질이 해수에 적합한가? (SS316L)            [수동]    │ │  │
│  │  └────────────────────────────────────────────────────────────────┘ │  │
│  │                                                                      │  │
│  │  [체크리스트 내보내기 (Excel)]  [리포트 생성 (PDF)]  [저장]          │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. 데이터 흐름 설계

### 4.1 P&ID 분석 파이프라인
```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      P&ID 분석 데이터 흐름                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  입력                                                                       │
│  ────                                                                       │
│  ┌─────────────┐                                                            │
│  │   P&ID      │                                                            │
│  │   PDF/PNG   │                                                            │
│  └──────┬──────┘                                                            │
│         │                                                                   │
│         ▼                                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     병렬 처리 레이어                                 │   │
│  │                                                                     │   │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │   │
│  │  │   YOLO-PID    │  │  Line Det.    │  │  OCR Ensemble │           │   │
│  │  │   (:5017)     │  │   (:5016)     │  │   (:5011)     │           │   │
│  │  └───────┬───────┘  └───────┬───────┘  └───────┬───────┘           │   │
│  │          │                  │                  │                   │   │
│  │          ▼                  ▼                  ▼                   │   │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │   │
│  │  │ symbols:      │  │ lines:        │  │ texts:        │           │   │
│  │  │ [{class,      │  │ [{start,      │  │ [{text,       │           │   │
│  │  │   bbox,       │  │   end,        │  │   confidence, │           │   │
│  │  │   conf}]      │  │   color}]     │  │   bbox}]      │           │   │
│  │  └───────────────┘  └───────────────┘  └───────────────┘           │   │
│  │                                                                     │   │
│  └────────────────────────────┬────────────────────────────────────────┘   │
│                               │                                             │
│                               ▼                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     분석 레이어                                      │   │
│  │                                                                     │   │
│  │  ┌────────────────────────────────────────────────────────────────┐ │   │
│  │  │                    PID Analyzer (:5018)                        │ │   │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │ │   │
│  │  │  │ 연결 분석    │  │ 장비 리스트  │  │ 밸브 리스트  │         │ │   │
│  │  │  │ connections  │  │ equipment    │  │ valves       │         │ │   │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘         │ │   │
│  │  └────────────────────────────────────────────────────────────────┘ │   │
│  │                               │                                     │   │
│  │                               ▼                                     │   │
│  │  ┌────────────────────────────────────────────────────────────────┐ │   │
│  │  │                  BWMS Checker (:5021) [NEW]                    │ │   │
│  │  │                                                                │ │   │
│  │  │  입력:                                                         │ │   │
│  │  │  • symbols (YOLO 결과)                                         │ │   │
│  │  │  • lines (Line Detector 결과)                                  │ │   │
│  │  │  • texts (OCR 결과)                                            │ │   │
│  │  │  • connections (PID Analyzer 결과)                             │ │   │
│  │  │                                                                │ │   │
│  │  │  ┌────────────────────────────────────────────────────────┐   │ │   │
│  │  │  │  1. BWMS 장비 태그 추출                                │   │ │   │
│  │  │  │     OCR texts에서 ECU/HGU/DMU 패턴 매칭               │   │ │   │
│  │  │  │     → bwms_equipment: [{tag, type, bbox}]              │   │ │   │
│  │  │  └────────────────────────────────────────────────────────┘   │ │   │
│  │  │                          │                                     │ │   │
│  │  │                          ▼                                     │ │   │
│  │  │  ┌────────────────────────────────────────────────────────┐   │ │   │
│  │  │  │  2. 위치 관계 분석                                     │   │ │   │
│  │  │  │     connections 그래프에서 upstream/downstream 계산    │   │ │   │
│  │  │  │     → topology: {upstream: {}, downstream: {}}         │   │ │   │
│  │  │  └────────────────────────────────────────────────────────┘   │ │   │
│  │  │                          │                                     │ │   │
│  │  │                          ▼                                     │ │   │
│  │  │  ┌────────────────────────────────────────────────────────┐   │ │   │
│  │  │  │  3. TECHCROSS 규칙 검증                                │   │ │   │
│  │  │  │     9개 규칙 순차 검증                                 │   │ │   │
│  │  │  │     → violations: [{rule_id, message, location}]       │   │ │   │
│  │  │  └────────────────────────────────────────────────────────┘   │ │   │
│  │  │                          │                                     │ │   │
│  │  │                          ▼                                     │ │   │
│  │  │  ┌────────────────────────────────────────────────────────┐   │ │   │
│  │  │  │  4. 체크리스트 생성                                    │   │ │   │
│  │  │  │     60개 항목 자동/수동 분류                           │   │ │   │
│  │  │  │     → checklist: [{item, status, auto_checked}]        │   │ │   │
│  │  │  └────────────────────────────────────────────────────────┘   │ │   │
│  │  │                                                                │ │   │
│  │  └────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                               │                                             │
│                               ▼                                             │
│  출력                                                                       │
│  ────                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  {                                                                  │   │
│  │    "bwms_equipment": [                                              │   │
│  │      {"tag": "ECU-001", "type": "ECU", "bbox": [100,200,150,250]},  │   │
│  │      {"tag": "HGU-001", "type": "HGU", "bbox": [300,100,350,150]}   │   │
│  │    ],                                                               │   │
│  │    "violations": [                                                  │   │
│  │      {"rule_id": "BWMS-004", "severity": "critical",                │   │
│  │       "message": "FMU-001이 ECU-001 후단에 위치하지 않음",          │   │
│  │       "location": {"bbox": [200,300,250,350]}}                      │   │
│  │    ],                                                               │   │
│  │    "checklist": [                                                   │   │
│  │      {"id": 1, "item": "ECU 용량 적합성", "status": "pass",         │   │
│  │       "auto_checked": true},                                        │   │
│  │      {"id": 2, "item": "안전밸브 위치", "status": "pending",        │   │
│  │       "auto_checked": false}                                        │   │
│  │    ],                                                               │   │
│  │    "visualization": "base64_image_with_highlights"                  │   │
│  │  }                                                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. API 설계

### 5.1 BWMS Checker API Spec

```yaml
# gateway-api/api_specs/bwms-checker.yaml

apiVersion: v1
kind: APISpec

metadata:
  id: bwms-checker
  name: BWMS Design Checker
  version: 1.0.0
  port: 5021
  description: TECHCROSS BWMS P&ID 설계 검증 API
  author: AX Team
  tags:
    - bwms
    - techcross
    - design-check

server:
  endpoint: /api/v1/check
  method: POST
  contentType: application/json
  timeout: 60
  healthEndpoint: /health

blueprintflow:
  category: analysis
  color: "#06b6d4"
  icon: ShieldCheck
  requiresImage: false

inputs:
  - name: symbols
    type: Detection[]
    required: true
    description: YOLO-PID 검출 결과
  - name: lines
    type: Line[]
    required: true
    description: Line Detector 결과
  - name: texts
    type: OCRResult[]
    required: true
    description: OCR Ensemble 결과
  - name: connections
    type: Connection[]
    required: true
    description: PID Analyzer 연결 분석 결과

outputs:
  - name: bwms_equipment
    type: BWMSEquipment[]
    description: BWMS 장비 목록
  - name: violations
    type: Violation[]
    description: 규칙 위반 항목
  - name: checklist
    type: ChecklistItem[]
    description: 자동 검증된 체크리스트
  - name: visualization
    type: Image
    description: 위반 사항 하이라이트 이미지

parameters:
  - name: system_type
    type: select
    default: ECS
    options: [ECS, HYCHLOR]
    description: BWMS 시스템 타입

  - name: strict_mode
    type: boolean
    default: true
    description: 엄격 모드 (모든 규칙 적용)

  - name: include_warnings
    type: boolean
    default: true
    description: 경고 수준 포함

i18n:
  ko:
    label: BWMS 설계 검증
    description: TECHCROSS BWMS P&ID 설계 규칙 자동 검증
  en:
    label: BWMS Design Check
    description: TECHCROSS BWMS P&ID design rule validation
```

### 5.2 BWMS 전용 BlueprintFlow 파이프라인

```
┌─────────────────────────────────────────────────────────────────────────────┐
│              BWMS P&ID 분석 파이프라인 (BlueprintFlow)                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────┐                                                                │
│  │  Image  │                                                                │
│  │  Input  │                                                                │
│  └────┬────┘                                                                │
│       │                                                                     │
│       ├──────────────────┬──────────────────┬─────────────────┐            │
│       │                  │                  │                 │            │
│       ▼                  ▼                  ▼                 ▼            │
│  ┌─────────┐       ┌─────────┐       ┌─────────┐       ┌─────────┐        │
│  │ YOLO    │       │  Line   │       │   OCR   │       │ ESRGAN  │        │
│  │  PID    │       │ Detector│       │ Ensemble│       │(optional│        │
│  └────┬────┘       └────┬────┘       └────┬────┘       └────┬────┘        │
│       │                 │                 │                 │              │
│       └────────────┬────┴─────────────────┴─────────────────┘              │
│                    │                                                        │
│                    ▼                                                        │
│             ┌────────────┐                                                  │
│             │    PID     │                                                  │
│             │  Analyzer  │                                                  │
│             └─────┬──────┘                                                  │
│                   │                                                         │
│                   ▼                                                         │
│            ┌─────────────┐                                                  │
│            │    BWMS     │  ← 신규 노드                                     │
│            │   Checker   │                                                  │
│            └─────┬───────┘                                                  │
│                  │                                                          │
│       ┌──────────┴──────────┬─────────────────┬───────────────┐            │
│       │                     │                 │               │            │
│       ▼                     ▼                 ▼               ▼            │
│  ┌─────────┐         ┌───────────┐     ┌───────────┐   ┌───────────┐      │
│  │Equipment│         │ Violation │     │ Checklist │   │ Report    │      │
│  │  List   │         │   List    │     │           │   │ Generator │      │
│  └─────────┘         └───────────┘     └───────────┘   └───────────┘      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. UI/UX 설계

### 6.1 BWMS Checker 페이지 레이아웃

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  AX Platform                    [Dashboard] [BlueprintFlow] [BWMS Checker]  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  BWMS P&ID Design Checker                              [ECS ▼] [Help] │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌────────────────────────────────────┬──────────────────────────────────┐ │
│  │         P&ID Viewer (60%)          │      Analysis Panel (40%)        │ │
│  │  ┌──────────────────────────────┐  │  ┌─────────────────────────────┐ │ │
│  │  │                              │  │  │ 📊 Summary                  │ │ │
│  │  │                              │  │  │ ────────────────────────    │ │ │
│  │  │                              │  │  │ Total Symbols: 142          │ │ │
│  │  │      [Interactive P&ID]      │  │  │ BWMS Equipment: 8           │ │ │
│  │  │                              │  │  │ Violations: 3 ⚠️             │ │ │
│  │  │    - Zoom/Pan 지원           │  │  │ Checklist: 45/60 ✓          │ │ │
│  │  │    - 클릭 시 상세정보        │  │  └─────────────────────────────┘ │ │
│  │  │    - 위반 영역 하이라이트    │  │                                  │ │
│  │  │                              │  │  ┌─────────────────────────────┐ │ │
│  │  │                              │  │  │ ⚠️ Violations               │ │ │
│  │  │                              │  │  │ ────────────────────────    │ │ │
│  │  │                              │  │  │ 🔴 BWMS-004: FMU 위치       │ │ │
│  │  │                              │  │  │    [Show on P&ID]          │ │ │
│  │  │                              │  │  │ 🔴 BWMS-001: G-2 포트       │ │ │
│  │  │                              │  │  │    [Show on P&ID]          │ │ │
│  │  │                              │  │  │ 🟡 BWMS-007: 용량 검증      │ │ │
│  │  │                              │  │  │    [Manual Check Required] │ │ │
│  │  └──────────────────────────────┘  │  └─────────────────────────────┘ │ │
│  │                                    │                                  │ │
│  │  [Zoom In] [Zoom Out] [Fit]        │  ┌─────────────────────────────┐ │ │
│  │  [Toggle: Symbols|Lines|Tags]      │  │ 🔧 Equipment List           │ │ │
│  │                                    │  │ ────────────────────────    │ │ │
│  │                                    │  │ ECU-001  Electrolyzer       │ │ │
│  │                                    │  │ HGU-001  Hydrogen Gas Unit  │ │ │
│  │                                    │  │ DMU-001  Direct Mix Unit    │ │ │
│  │                                    │  │ FMU-001  Filter Module      │ │ │
│  │                                    │  │ ...                         │ │ │
│  │                                    │  └─────────────────────────────┘ │ │
│  └────────────────────────────────────┴──────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  📋 Checklist                                              [Export]   │ │
│  │  ─────────────────────────────────────────────────────────────────    │ │
│  │                                                                       │ │
│  │  ┌─ 장비 배치 검토 ──────────────────────────────────────── 12/15 ─┐ │ │
│  │  │ ✅ ECU 용량이 선박 밸러스트 용량에 적합한가?        [Auto]      │ │ │
│  │  │ ✅ HGU가 올바른 위치에 설치되어 있는가?             [Auto]      │ │ │
│  │  │ ❌ FMU가 ECU 후단에 위치하는가?                     [Auto]      │ │ │
│  │  │ ☐ 모든 안전 밸브가 표시되어 있는가?                 [Manual]    │ │ │
│  │  │ ☐ 비상 차단 밸브 위치가 적절한가?                   [Manual]    │ │ │
│  │  └─────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                       │ │
│  │  ┌─ 배관 검토 ───────────────────────────────────────────── 8/10 ──┐ │ │
│  │  │ ✅ G-2 샘플링 포트가 상류에 있는가?                  [Auto]      │ │ │
│  │  │ ✅ 최소 5D 거리가 확보되었는가?                      [Auto]      │ │ │
│  │  │ ☐ 라인 재질이 해수에 적합한가?                      [Manual]    │ │ │
│  │  └─────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  [Upload New P&ID]            [Generate Report (PDF)]            [Save]    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 리포트 출력 형식

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    BWMS P&ID Design Verification Report                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  PROJECT INFORMATION                                                  │ │
│  │  ─────────────────────────────────────────────────────────────────    │ │
│  │  Project No: YZJ2023-1584                                             │ │
│  │  Ship Name: NK Vessel                                                 │ │
│  │  System: ECS 1000B x 1                                                │ │
│  │  Drawing: [PNID] REV.0 YZJ2023-1584_1585_NK_ECS1000Bx1_MIX.pdf        │ │
│  │  Revision: Rev.0                                                      │ │
│  │  Verification Date: 2025-12-25                                        │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  SUMMARY                                                              │ │
│  │  ─────────────────────────────────────────────────────────────────    │ │
│  │                                                                       │ │
│  │  ┌─────────────────┬─────────────────┬─────────────────┐             │ │
│  │  │ Total Checks    │ Passed          │ Failed          │             │ │
│  │  │      60         │    45 (75%)     │    3 (5%)       │             │ │
│  │  └─────────────────┴─────────────────┴─────────────────┘             │ │
│  │                                                                       │ │
│  │  Manual Review Required: 12 items                                     │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  CRITICAL VIOLATIONS                                                  │ │
│  │  ─────────────────────────────────────────────────────────────────    │ │
│  │                                                                       │ │
│  │  1. [BWMS-004] FMU Position Error                                     │ │
│  │     Status: FAIL                                                      │ │
│  │     Description: FMU-001 is not positioned downstream of ECU-001     │ │
│  │     Location: Drawing coordinate (200, 300)                           │ │
│  │     Required Action: Relocate FMU-001 to ECU downstream              │ │
│  │                                                                       │ │
│  │  2. [BWMS-001] G-2 Sampling Port Position                             │ │
│  │     Status: FAIL                                                      │ │
│  │     Description: G-2 port is not at upstream position                │ │
│  │     Location: Drawing coordinate (450, 200)                           │ │
│  │     Required Action: Move G-2 port to upstream of treatment unit     │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  EQUIPMENT LIST                                                       │ │
│  │  ─────────────────────────────────────────────────────────────────    │ │
│  │                                                                       │ │
│  │  Tag      │ Description              │ Status    │ Notes              │ │
│  │  ──────────────────────────────────────────────────────────────────   │ │
│  │  ECU-001  │ Electrolyzer Cell Unit   │ OK        │                    │ │
│  │  HGU-001  │ Hydrogen Gas Unit        │ OK        │ Above ECU          │ │
│  │  DMU-001  │ Direct Mix Unit          │ OK        │                    │ │
│  │  FMU-001  │ Filter Module Unit       │ WARNING   │ Position issue     │ │
│  │  GDS-001  │ Gas Dilution System      │ OK        │                    │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  P&ID WITH ANNOTATIONS                                                │ │
│  │  ─────────────────────────────────────────────────────────────────    │ │
│  │                                                                       │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │ │
│  │  │                                                                 │ │ │
│  │  │                    [Annotated P&ID Image]                       │ │ │
│  │  │                                                                 │ │ │
│  │  │   Red boxes = Critical violations                               │ │ │
│  │  │   Yellow boxes = Warnings                                       │ │ │
│  │  │   Green boxes = Verified equipment                              │ │ │
│  │  │                                                                 │ │ │
│  │  └─────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │  VERIFICATION CHECKLIST                                               │ │
│  │  ─────────────────────────────────────────────────────────────────    │ │
│  │                                                                       │ │
│  │  (60 항목 체크리스트 상세 내역)                                       │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ───────────────────────────────────────────────────────────────────────── │
│  Generated by: AX Platform v1.0                                             │
│  Verified by: ________________  Date: ________________  Sign: ____________  │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 파일 구조 변경 계획

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    프로젝트 파일 구조 변경                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ax/poc/                                                                    │
│  │                                                                          │
│  ├── models/                                                                │
│  │   │                                                                      │
│  │   ├── bwms-checker-api/           ← [NEW] BWMS 검증 API                 │
│  │   │   ├── api_server.py                                                  │
│  │   │   ├── bwms_rules.py           ← TECHCROSS 설계 규칙                  │
│  │   │   ├── equipment_detector.py   ← BWMS 장비 태그 인식                  │
│  │   │   ├── topology_analyzer.py    ← 위치 관계 분석                       │
│  │   │   ├── checklist_generator.py  ← 체크리스트 생성                      │
│  │   │   ├── Dockerfile                                                     │
│  │   │   └── requirements.txt                                               │
│  │   │                                                                      │
│  │   └── (기존 API 서비스들...)                                             │
│  │                                                                          │
│  ├── gateway-api/                                                           │
│  │   │                                                                      │
│  │   ├── api_specs/                                                         │
│  │   │   └── bwms-checker.yaml       ← [NEW] BWMS Checker 스펙             │
│  │   │                                                                      │
│  │   └── blueprintflow/                                                     │
│  │       └── executors/                                                     │
│  │           └── bwms_executor.py    ← [NEW] BWMS 파이프라인 Executor       │
│  │                                                                          │
│  ├── web-ui/                                                                │
│  │   └── src/                                                               │
│  │       ├── pages/                                                         │
│  │       │   └── bwms/               ← [NEW] BWMS Checker 페이지           │
│  │       │       ├── BWMSChecker.tsx                                        │
│  │       │       ├── components/                                            │
│  │       │       │   ├── PIDViewer.tsx                                      │
│  │       │       │   ├── ViolationPanel.tsx                                 │
│  │       │       │   ├── ChecklistPanel.tsx                                 │
│  │       │       │   └── ReportGenerator.tsx                                │
│  │       │       └── hooks/                                                 │
│  │       │           └── useBWMSAnalysis.ts                                 │
│  │       │                                                                  │
│  │       ├── config/                                                        │
│  │       │   └── bwmsRules.ts        ← [NEW] BWMS 규칙 정의               │
│  │       │                                                                  │
│  │       └── locales/                                                       │
│  │           ├── ko.json             ← 한국어 번역 추가                     │
│  │           └── en.json             ← 영어 번역 추가                       │
│  │                                                                          │
│  └── apply-company/                                                         │
│      └── techloss/                                                          │
│          ├── TECHLOSS_자료_정리.md                                          │
│          ├── TECHLOSS_시각적_설명.md                                        │
│          ├── TECHLOSS_미구현기능_평가.md                                    │
│          └── TECHLOSS_서비스통합_계획.md   ← 현재 문서                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. 개발 로드맵

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         개발 로드맵 (Phase 기반)                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Phase 0: 준비 단계 (1일)                                                   │
│  ━━━━━━━━━━━━━━━━━━━━━━━                                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  □ 샘플 P&ID PDF → PNG 변환 및 테스트 이미지 준비                   │   │
│  │  □ 현재 시스템으로 샘플 분석 테스트 (YOLO, OCR, Line Detector)      │   │
│  │  □ BWMS 장비 태그 수동 라벨링 (ECU, HGU 등 위치 확인)               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│                                      ▼                                      │
│  Phase 1: 백엔드 기반 구축 (3-4일)                                          │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  □ bwms-checker-api 프로젝트 스캐폴딩                               │   │
│  │  □ BWMS 장비 태그 패턴 인식 (OCR 결과 기반)                         │   │
│  │  □ 기본 위치 관계 분석 로직                                         │   │
│  │  □ BWMS 규칙 3개 구현 (BWMS-001, 004, 005)                          │   │
│  │  □ API 스펙 (bwms-checker.yaml) 작성                                │   │
│  │  □ Docker 컨테이너 구성                                             │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│                                      ▼                                      │
│  Phase 2: 프론트엔드 기본 UI (3-4일)                                        │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  □ BWMS Checker 페이지 라우팅 설정                                   │   │
│  │  □ P&ID 업로드 컴포넌트                                             │   │
│  │  □ P&ID 뷰어 (Zoom/Pan, 하이라이트)                                 │   │
│  │  □ 분석 결과 패널 (위반 사항 표시)                                  │   │
│  │  □ 기본 체크리스트 UI                                               │   │
│  │  □ Gateway 파이프라인 연동                                          │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│                                      ▼                                      │
│  Phase 3: 핵심 기능 완성 (4-5일)                                            │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  □ 나머지 BWMS 규칙 구현 (BWMS-002, 003, 006, 007, 008, 009)        │   │
│  │  □ 60개 체크리스트 항목 정의 및 자동/수동 분류                       │   │
│  │  □ 체크리스트 자동 검증 로직                                        │   │
│  │  □ P&ID 위반 영역 인터랙티브 하이라이트                              │   │
│  │  □ 장비 목록 자동 생성                                               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                      │
│                                      ▼                                      │
│  Phase 4: 리포트 및 마무리 (2-3일)                                          │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  □ PDF 리포트 생성 기능                                             │   │
│  │  □ Excel 체크리스트 내보내기                                         │   │
│  │  □ 다국어 지원 (한국어/영어)                                        │   │
│  │  □ 테스트 및 버그 수정                                               │   │
│  │  □ 문서화                                                            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│  총 예상 기간: 약 2-3주 (13-17일)                                           │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. 기술적 고려사항

### 9.1 기존 시스템 재사용

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       기존 컴포넌트 재사용 전략                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  100% 재사용 (수정 없음)                                                    │
│  ━━━━━━━━━━━━━━━━━━━━━━                                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  • YOLO-PID (:5017) - P&ID 심볼 검출 그대로 사용                    │   │
│  │  • Line Detector (:5016) - 라인 검출 그대로 사용                    │   │
│  │  • OCR Ensemble (:5011) - 텍스트 인식 그대로 사용                   │   │
│  │  • ESRGAN (:5010) - 이미지 업스케일 (필요시)                        │   │
│  │  • Gateway API (:8000) - 파이프라인 오케스트레이션                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  확장 재사용 (일부 수정)                                                    │
│  ━━━━━━━━━━━━━━━━━━━━━━                                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  • PID Analyzer (:5018)                                             │   │
│  │    - 기존 연결 분석 로직 재사용                                     │   │
│  │    - BWMS 장비 카테고리 추가 (equipment_types 확장)                 │   │
│  │                                                                     │   │
│  │  • Design Checker (:5019)                                           │   │
│  │    - 기존 규칙 엔진 프레임워크 재사용                               │   │
│  │    - BWMS 규칙만 별도 파일로 분리 추가 가능                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  신규 개발 (새로 작성)                                                      │
│  ━━━━━━━━━━━━━━━━━━━━                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  • BWMS Checker API (:5021) - 신규 서비스                           │   │
│  │  • BWMS Checker UI - 신규 프론트엔드 페이지                         │   │
│  │  • BWMS Pipeline - Gateway Executor 추가                            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 9.2 확장성 고려

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          확장성 설계                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  다른 고객사 적용 가능성                                                    │
│  ━━━━━━━━━━━━━━━━━━━━━━━                                                      │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                                                                     │   │
│  │                      ┌─────────────────┐                            │   │
│  │                      │  Rule Engine    │                            │   │
│  │                      │  (Common)       │                            │   │
│  │                      └────────┬────────┘                            │   │
│  │                               │                                     │   │
│  │          ┌────────────────────┼────────────────────┐                │   │
│  │          │                    │                    │                │   │
│  │          ▼                    ▼                    ▼                │   │
│  │  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐          │   │
│  │  │  TECHCROSS   │    │   고객사 B   │    │   고객사 C   │          │   │
│  │  │  BWMS Rules  │    │   Rules      │    │   Rules      │          │   │
│  │  │  (9개 규칙)  │    │              │    │              │          │   │
│  │  └──────────────┘    └──────────────┘    └──────────────┘          │   │
│  │                                                                     │   │
│  │  설계 포인트:                                                       │   │
│  │  • 규칙은 JSON/YAML 파일로 분리하여 교체 가능                       │   │
│  │  • 체크리스트도 설정 파일로 분리                                    │   │
│  │  • UI는 공통, 규칙/체크리스트만 고객사별 커스터마이징               │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 10. 결론

### 핵심 통합 포인트

| 영역 | 통합 방식 | 재사용율 |
|------|----------|---------|
| **심볼 검출** | YOLO-PID 그대로 사용 + OCR 패턴 매칭 | 100% |
| **연결 분석** | PID Analyzer 그대로 사용 | 100% |
| **규칙 검증** | 신규 BWMS Checker API | 신규 |
| **UI** | 신규 BWMS Checker 페이지 | 신규 |
| **파이프라인** | Gateway에 BWMS Executor 추가 | 확장 |

### 예상 개발 범위

| 항목 | 파일 수 | 예상 코드량 |
|------|---------|------------|
| BWMS Checker API | 5개 | ~1500줄 |
| Frontend 페이지 | 6개 | ~2000줄 |
| API Spec/Config | 3개 | ~300줄 |
| Gateway Executor | 1개 | ~200줄 |
| **합계** | **15개** | **~4000줄** |

### 다음 단계

1. **Phase 0 진행**: 샘플 P&ID 테스트
2. **설계 확정**: 이 문서 기반 최종 설계 검토
3. **Phase 1 착수**: BWMS Checker API 개발 시작

---

**문서 작성자**: Claude AI
**최종 업데이트**: 2025-12-25

version: '3.8'

# AX Ïã§Ï¶ùÏÇ∞Îã® - ÎßàÏù¥ÌÅ¨Î°úÏÑúÎπÑÏä§ API ÏãúÏä§ÌÖú
# Ï†ÑÏ≤¥ ÏãúÏä§ÌÖú ÌÜµÌï© Docker Compose

services:
  # =====================
  # eDOCr2 v2 API (Ìè¨Ìä∏ 5002)
  # =====================
  edocr2-v2-api:
    build:
      context: ./models/edocr2-v2-api
      dockerfile: Dockerfile
    container_name: edocr2-v2-api
    ports:
      - "5002:5002"
    volumes:
      # eDOCr2 source code and models are now included in the Docker image
      # Only mount uploads/results for data persistence
      - ./models/edocr2-v2-api/uploads:/tmp/edocr2/uploads
      - ./models/edocr2-v2-api/results:/tmp/edocr2/results
    environment:
      - EDOCR2_PORT=5002
      - EDOCR2_WORKERS=1
      - EDOCR2_MODEL_PATH=/models
      - EDOCR2_VERSION=v2
      - EDOCR2_LOG_LEVEL=INFO
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5002/api/v2/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # =====================
  # EDGNet API (Ìè¨Ìä∏ 5012)
  # =====================
  edgnet-api:
    build:
      context: ./models/edgnet-api
      dockerfile: Dockerfile
    container_name: edgnet-api
    ports:
      - "5012:5002"
    volumes:
      # EDGNet source code and GraphSAGE models are now included in the Docker image
      # Only mount uploads/results for data persistence
      - ./models/edgnet-api/uploads:/tmp/edgnet/uploads
      - ./models/edgnet-api/results:/tmp/edgnet/results
    environment:
      - EDGNET_PORT=5002
      - EDGNET_WORKERS=2
      - EDGNET_MODEL_PATH=/trained_models/graphsage_dimension_classifier.pth
      - EDGNET_LOG_LEVEL=INFO
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    # GPU ÏßÄÏõê ÌôúÏÑ±Ìôî ‚úÖ
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5002/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # =====================
  # Skin Model API (Ìè¨Ìä∏ 5003)
  # =====================
  skinmodel-api:
    build:
      context: ./models/skinmodel-api
      dockerfile: Dockerfile
    container_name: skinmodel-api
    ports:
      - "5003:5003"
    volumes:
      - ./models/skinmodel-api/data:/tmp/skinmodel/data
      - ./models/skinmodel-api/output:/tmp/skinmodel/output
    environment:
      - SKINMODEL_PORT=5003
      - SKINMODEL_WORKERS=2
      - SKINMODEL_LOG_LEVEL=INFO
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5003/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # =====================
  # Vision Language Model API (Ìè¨Ìä∏ 5004)
  # =====================
  vl-api:
    build:
      context: ./models/vl-api
      dockerfile: Dockerfile
    container_name: vl-api
    ports:
      - "5004:5004"
    volumes:
      - ./models/vl-api/uploads:/tmp/vl-api/uploads
    environment:
      - VL_API_PORT=5004
      - VL_API_WORKERS=2
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5004/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # =====================
  # YOLOv11 API (Ìè¨Ìä∏ 5005)
  # =====================
  yolo-api:
    build:
      context: ./models/yolo-api
      dockerfile: Dockerfile
    container_name: yolo-api
    ports:
      - "5005:5005"
    volumes:
      - ./models/yolo-api/models:/app/models:ro
      - ./models/yolo-api/uploads:/tmp/yolo-api/uploads
      - ./models/yolo-api/results:/tmp/yolo-api/results
    environment:
      - YOLO_API_PORT=5005
      - YOLO_MODEL_PATH=/app/models/best.pt
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    # GPU ÏßÄÏõê ÌôúÏÑ±Ìôî ‚úÖ
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5005/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # =====================
  # PaddleOCR API (Ìè¨Ìä∏ 5006)
  # =====================
  paddleocr-api:
    build:
      context: ./models/paddleocr-api
      dockerfile: Dockerfile
    container_name: paddleocr-api
    ports:
      - "5006:5006"
    volumes:
      - ./models/paddleocr-api/uploads:/tmp/paddleocr-api/uploads
      - ./models/paddleocr-api/results:/tmp/paddleocr-api/results
    environment:
      - PADDLEOCR_PORT=5006
      - USE_GPU=true
      - USE_ANGLE_CLS=true
      - OCR_LANG=en
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    # GPU ÏßÄÏõê ÌôúÏÑ±Ìôî ‚úÖ
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5006/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # =====================
  # Gateway API (Ìè¨Ìä∏ 8000)
  # =====================
  gateway-api:
    build:
      context: ./gateway-api
      dockerfile: Dockerfile
    container_name: gateway-api
    ports:
      - "8000:8000"
    volumes:
      # üî• Í∞úÎ∞ú ÌôòÍ≤Ω: ÏÜåÏä§ ÏΩîÎìú Ïã§ÏãúÍ∞Ñ Î∞òÏòÅÏùÑ ÏúÑÌïú Î≥ºÎ•® ÎßàÏö¥Ìä∏
      - ./gateway-api/api_server.py:/app/api_server.py
      - ./gateway-api/api_registry.py:/app/api_registry.py
      - ./gateway-api/pdf_generator.py:/app/pdf_generator.py
      - ./gateway-api/cost_estimator.py:/app/cost_estimator.py
      - ./gateway-api/services:/app/services
      - ./gateway-api/models:/app/models
      - ./gateway-api/utils:/app/utils
      - ./gateway-api/blueprintflow:/app/blueprintflow
      - ./gateway-api/routers:/app/routers
      - ./gateway-api/api_specs:/app/api_specs
      # Îç∞Ïù¥ÌÑ∞ ÎîîÎ†âÌÜ†Î¶¨
      - ./gateway-api/uploads:/tmp/gateway/uploads
      - ./gateway-api/results:/tmp/gateway/results
      # Docker Ï†úÏñ¥Î•º ÏúÑÌïú ÏÜåÏºì ÎßàÏö¥Ìä∏
      - /var/run/docker.sock:/var/run/docker.sock
      # docker-compose ÌååÏùº Ï†ëÍ∑º (GPU ÏÑ§Ï†ï Ïò§Î≤ÑÎùºÏù¥ÎìúÏö©)
      - ./:/home/uproot/ax/poc
      # Î™®Îç∏ ÎîîÎ†âÌÜ†Î¶¨ (Admin Î™®Îç∏ Í¥ÄÎ¶¨Ïö©)
      - ./models/yolo-api/models:/app/admin_models/yolo:ro
      - ./models/skinmodel-api/models:/app/admin_models/skinmodel:ro
      - ./models/edgnet-api/models:/app/admin_models/edgnet:ro
      - ./models/edocr2-api/models:/app/admin_models/edocr2:ro
      - ./models/edocr2-v2-api/models:/app/admin_models/edocr2-v2:ro
    environment:
      - GATEWAY_PORT=8000
      - GATEWAY_WORKERS=4
      - EDOCR_V2_URL=http://edocr2-v2-api:5002
      - EDOCR2_URL=http://edocr2-v2-api:5002
      - EDGNET_URL=http://edgnet-api:5002
      - SKINMODEL_URL=http://skinmodel-api:5003
      - VL_API_URL=http://vl-api:5004
      - YOLO_API_URL=http://yolo-api:5005
      - PADDLEOCR_URL=http://paddleocr-api:5006
      - KNOWLEDGE_API_URL=http://knowledge-api:5007
      - SURYA_OCR_URL=http://surya-ocr-api:5013
      - DOCTR_URL=http://doctr-api:5014
      - EASYOCR_URL=http://easyocr-api:5015
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=ax_poc_2024
      - GATEWAY_LOG_LEVEL=INFO
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # =====================
  # Web UI (Ìè¨Ìä∏ 5173)
  # =====================
  web-ui:
    build:
      context: ./web-ui
      dockerfile: Dockerfile.dev
    container_name: web-ui
    ports:
      - "5173:5173"
    volumes:
      - ./web-ui/src:/app/src
      - ./web-ui/public:/app/public
      - ./web-ui/index.html:/app/index.html
      - ./web-ui/vite.config.ts:/app/vite.config.ts
      - ./web-ui/tsconfig.json:/app/tsconfig.json
      - ./web-ui/tailwind.config.js:/app/tailwind.config.js
    environment:
      - VITE_GATEWAY_URL=http://localhost:8000
      - VITE_EDOCR2_URL=http://localhost:5001
      - VITE_EDGNET_URL=http://localhost:5012
      - VITE_SKINMODEL_URL=http://localhost:5003
    networks:
      - ax_poc_network
    restart: unless-stopped
    depends_on:
      - gateway-api
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:5173/"]
      interval: 30s
      timeout: 15s
      retries: 5
      start_period: 30s

  # =====================
  # Neo4j Graph Database (Ìè¨Ìä∏ 7474, 7687)
  # =====================
  neo4j:
    image: neo4j:5.15.0-community
    container_name: neo4j
    ports:
      - "7474:7474"  # HTTP
      - "7687:7687"  # Bolt
    volumes:
      - ./data/neo4j/data:/data
      - ./data/neo4j/logs:/logs
      - ./data/neo4j/import:/var/lib/neo4j/import
      - ./data/neo4j/plugins:/plugins
    environment:
      - NEO4J_AUTH=neo4j/ax_poc_2024
      - NEO4J_PLUGINS=["apoc"]
      - NEO4J_dbms_security_procedures_unrestricted=apoc.*
      - NEO4J_dbms_memory_heap_initial__size=512m
      - NEO4J_dbms_memory_heap_max__size=1G
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:7474"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # =====================
  # Knowledge API - GraphRAG + VectorRAG (Ìè¨Ìä∏ 5007)
  # =====================
  knowledge-api:
    build:
      context: ./models/knowledge-api
      dockerfile: Dockerfile
    container_name: knowledge-api
    ports:
      - "5007:5007"
    volumes:
      - ./models/knowledge-api/data:/app/data
      - ./models/knowledge-api/indexes:/app/indexes
    environment:
      - KNOWLEDGE_API_PORT=5007
      - NEO4J_URI=bolt://neo4j:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=ax_poc_2024
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    depends_on:
      - neo4j
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5007/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # =====================
  # Tesseract OCR API
  # =====================
  tesseract-api:
    build:
      context: ./models/tesseract-api
      dockerfile: Dockerfile
    container_name: tesseract-api
    ports:
      - "5008:5008"
    environment:
      - TESSERACT_API_PORT=5008
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5008/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # =====================
  # TrOCR API (Transformer OCR)
  # =====================
  trocr-api:
    build:
      context: ./models/trocr-api
      dockerfile: Dockerfile
    container_name: trocr-api
    ports:
      - "5009:5009"
    volumes:
      - trocr_models:/root/.cache/huggingface
    environment:
      - TROCR_API_PORT=5009
      - TROCR_MODEL=microsoft/trocr-base-printed
      - TROCR_DEVICE=cuda
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    # GPU ÏßÄÏõê ÌôúÏÑ±Ìôî ‚úÖ
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5009/health"]
      interval: 30s
      timeout: 30s
      retries: 3
      start_period: 120s

  # =====================
  # ESRGAN Upscaler API
  # =====================
  esrgan-api:
    build:
      context: ./models/esrgan-api
      dockerfile: Dockerfile
    container_name: esrgan-api
    ports:
      - "5010:5010"
    volumes:
      - esrgan_weights:/app/weights
    environment:
      - ESRGAN_API_PORT=5010
      - ESRGAN_DEVICE=cuda
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    # GPU ÏßÄÏõê ÌôúÏÑ±Ìôî ‚úÖ
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5010/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # =====================
  # OCR Ensemble API (Í∞ÄÏ§ë Ìà¨Ìëú)
  # =====================
  ocr-ensemble-api:
    build:
      context: ./models/ocr-ensemble-api
      dockerfile: Dockerfile
    container_name: ocr-ensemble-api
    ports:
      - "5011:5011"
    environment:
      - ENSEMBLE_API_PORT=5011
      - EDOCR2_URL=http://edocr2-v2-api:5002
      - PADDLEOCR_URL=http://paddleocr-api:5006
      - TESSERACT_URL=http://tesseract-api:5008
      - TROCR_URL=http://trocr-api:5009
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    depends_on:
      - edocr2-v2-api
      - paddleocr-api
      - tesseract-api
      - trocr-api
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5011/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # =====================
  # Surya OCR API (Ìè¨Ìä∏ 5013)
  # 90+ Ïñ∏Ïñ¥, Î†àÏù¥ÏïÑÏõÉ Î∂ÑÏÑù, GPU Í∂åÏû•
  # =====================
  surya-ocr-api:
    build:
      context: ./models/surya-ocr-api
      dockerfile: Dockerfile
    container_name: surya-ocr-api
    ports:
      - "5013:5013"
    volumes:
      - surya_models:/root/.cache
      - ./models/surya-ocr-api/uploads:/tmp/surya-ocr/uploads
      - ./models/surya-ocr-api/results:/tmp/surya-ocr/results
    environment:
      - SURYA_OCR_PORT=5013
      - SURYA_DEVICE=cpu
      - CUDA_VISIBLE_DEVICES=
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5013/health"]
      interval: 30s
      timeout: 30s
      retries: 3
      start_period: 120s

  # =====================
  # DocTR API (Ìè¨Ìä∏ 5014)
  # 2-stage OCR (Detection + Recognition), Apache 2.0
  # =====================
  doctr-api:
    build:
      context: ./models/doctr-api
      dockerfile: Dockerfile
    container_name: doctr-api
    ports:
      - "5014:5014"
    volumes:
      - doctr_models:/root/.cache
      - ./models/doctr-api/uploads:/tmp/doctr/uploads
      - ./models/doctr-api/results:/tmp/doctr/results
    environment:
      - DOCTR_PORT=5014
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5014/health"]
      interval: 30s
      timeout: 30s
      retries: 3
      start_period: 60s

  # =====================
  # EasyOCR API (Ìè¨Ìä∏ 5015)
  # 80+ Ïñ∏Ïñ¥, CPU ÏπúÌôîÏ†Å, ÌïúÍµ≠Ïñ¥ ÏßÄÏõê
  # =====================
  easyocr-api:
    build:
      context: ./models/easyocr-api
      dockerfile: Dockerfile
    container_name: easyocr-api
    ports:
      - "5015:5015"
    volumes:
      - easyocr_models:/root/.EasyOCR
      - ./models/easyocr-api/uploads:/tmp/easyocr/uploads
      - ./models/easyocr-api/results:/tmp/easyocr/results
    environment:
      - EASYOCR_PORT=5015
      - EASYOCR_GPU=false
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5015/health"]
      interval: 30s
      timeout: 30s
      retries: 3
      start_period: 120s

  # =====================
  # P&ID Analysis APIs
  # =====================

  # Line Detector API (Ìè¨Ìä∏ 5016)
  # LSD + Hough Transform Í∏∞Î∞ò ÎùºÏù∏ Í≤ÄÏ∂ú
  line-detector-api:
    build:
      context: ./models/line-detector-api
      dockerfile: Dockerfile
    container_name: line-detector-api
    ports:
      - "5016:5016"
    volumes:
      - ./models/line-detector-api/uploads:/tmp/line-detector/uploads
      - ./models/line-detector-api/results:/tmp/line-detector/results
    environment:
      - LINE_DETECTOR_PORT=5016
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5016/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # =====================
  # [DEPRECATED] YOLO-PID API (Ìè¨Ìä∏ 5017)
  # ‚ùå ÌÜµÌï© YOLO API (5005)Î°ú ÎåÄÏ≤¥Îê®
  # Î™®Îç∏ ÏÑ†ÌÉù: model_type=pid_symbol ÏÇ¨Ïö©
  # =====================
  # yolo-pid-api:
  #   build:
  #     context: ./models/yolo-pid-api
  #     dockerfile: Dockerfile
  #   container_name: yolo-pid-api
  #   ports:
  #     - "5017:5017"
  #   volumes:
  #     - ./models/yolo-pid-api:/app/model_dir:ro
  #     - ./models/yolo-pid-api/uploads:/tmp/yolo-pid/uploads
  #     - ./models/yolo-pid-api/results:/tmp/yolo-pid/results
  #   environment:
  #     - YOLO_PID_PORT=5017
  #     - YOLO_PID_MODEL=/app/model_dir/pid_symbol_detector.pt
  #     - PYTHONUNBUFFERED=1
  #   networks:
  #     - ax_poc_network
  #   restart: unless-stopped
  #   deploy:
  #     resources:
  #       reservations:
  #         devices:
  #           - driver: nvidia
  #             count: 1
  #             capabilities: [gpu]
  #   healthcheck:
  #     test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5017/health')"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 3
  #     start_period: 60s

  # PID Analyzer API (Ìè¨Ìä∏ 5018)
  # Ïã¨Î≥º Ïó∞Í≤∞ Î∂ÑÏÑù, BOM ÏÉùÏÑ±
  pid-analyzer-api:
    build:
      context: ./models/pid-analyzer-api
      dockerfile: Dockerfile
    container_name: pid-analyzer-api
    ports:
      - "5018:5018"
    volumes:
      - ./models/pid-analyzer-api/uploads:/tmp/pid-analyzer/uploads
      - ./models/pid-analyzer-api/results:/tmp/pid-analyzer/results
    environment:
      - PID_ANALYZER_PORT=5018
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5018/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # Design Checker API (Ìè¨Ìä∏ 5019)
  # P&ID ÏÑ§Í≥Ñ Í∑úÏπô Í≤ÄÏ¶ù
  design-checker-api:
    build:
      context: ./models/design-checker-api
      dockerfile: Dockerfile
    container_name: design-checker-api
    ports:
      - "5019:5019"
    volumes:
      - ./models/design-checker-api/uploads:/tmp/design-checker/uploads
      - ./models/design-checker-api/results:/tmp/design-checker/results
    environment:
      - DESIGN_CHECKER_PORT=5019
      - PYTHONUNBUFFERED=1
    networks:
      - ax_poc_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5019/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # =====================
  # Blueprint AI BOM (Ìè¨Ìä∏ 5020)
  # Human-in-the-Loop Í∏∞Î∞ò ÎèÑÎ©¥ Î∂ÑÏÑù Î∞è BOM ÏÉùÏÑ±
  # =====================
  blueprint-ai-bom-backend:
    build:
      context: ./blueprint-ai-bom/backend
      dockerfile: Dockerfile
    container_name: blueprint-ai-bom-backend
    ports:
      - "5020:5020"
    volumes:
      - ./blueprint-ai-bom/uploads:/app/uploads
      - ./blueprint-ai-bom/results:/app/results
      - ./blueprint-ai-bom/config:/app/config
      - ./blueprint-ai-bom/models:/app/models:ro
      - ./blueprint-ai-bom/classes_info_with_pricing.json:/app/classes_info_with_pricing.json:ro
      - ./blueprint-ai-bom/test_drawings:/app/test_drawings:ro
      - ./blueprint-ai-bom/class_examples:/app/class_examples:ro
    environment:
      - PYTHONUNBUFFERED=1
      - BOM_PORT=5020
      - YOLO_API_URL=http://yolo-api:5005
    networks:
      - ax_poc_network
    restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5020/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

  blueprint-ai-bom-frontend:
    build:
      context: ./blueprint-ai-bom/frontend
      dockerfile: Dockerfile
    container_name: blueprint-ai-bom-frontend
    ports:
      - "3000:80"
    depends_on:
      - blueprint-ai-bom-backend
    networks:
      - ax_poc_network
    restart: unless-stopped

networks:
  ax_poc_network:
    name: ax_poc_network
    driver: bridge

volumes:
  neo4j_data:
  neo4j_logs:
  knowledge_data:
  knowledge_indexes:
  edocr2_uploads:
  edocr2_results:
  edgnet_uploads:
  edgnet_results:
  skinmodel_data:
  skinmodel_output:
  yolo_uploads:
  yolo_results:
  gateway_uploads:
  gateway_results:
  trocr_models:
  esrgan_weights:
  surya_models:
  doctr_models:
  easyocr_models:
  bom_uploads:
  bom_results:

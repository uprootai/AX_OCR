# Parts List Parser API Specification
# Gateway ë‚´ë¶€ ì²˜ë¦¬ (ë³„ë„ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì—†ìŒ)
# Table Detector + í—¤ë” ì •ê·œí™” + ì¬ì§ˆ ì½”ë“œ ì •ê·œí™”

apiVersion: v1
kind: APISpec

metadata:
  id: partslist
  name: Parts List Parser
  version: 1.0.0
  port: 8000  # Gateway ë‚´ë¶€ ì²˜ë¦¬
  host: gateway-api
  description: ë„ë©´ Parts List í…Œì´ë¸”ì—ì„œ ë¶€í’ˆë²ˆí˜¸, í’ˆëª…, ì¬ì§ˆ, ìˆ˜ëŸ‰ ë“± êµ¬ì¡°í™”ëœ ì •ë³´ ì¶”ì¶œ
  author: AX Team
  tags:
    - analysis
    - parts-list
    - bom
    - table

server:
  endpoint: /api/v1/partslist/parse
  method: POST
  contentType: multipart/form-data
  timeout: 60
  healthEndpoint: /health

blueprintflow:
  category: analysis
  color: "#10b981"
  icon: Table
  requiresImage: true

inputs:
  - name: image
    type: Image
    required: true
    description: ë„ë©´ ì´ë¯¸ì§€ (Parts List í¬í•¨)
  - name: tables
    type: Table[]
    required: false
    description: Table Detector ê²°ê³¼ (ìˆìœ¼ë©´ ì¬ì‚¬ìš©)

outputs:
  - name: parts_list
    type: PartsListData
    description: íŒŒì‹±ëœ Parts List ë°ì´í„°
  - name: parts
    type: Part[]
    description: ë¶€í’ˆ ëª©ë¡ ë°°ì—´
  - name: parts_count
    type: number
    description: ì¶”ì¶œëœ ë¶€í’ˆ ê°œìˆ˜
  - name: headers
    type: string[]
    description: ì •ê·œí™”ëœ í—¤ë” ëª©ë¡
  - name: raw_tables
    type: Table[]
    description: ì›ë³¸ í…Œì´ë¸” ë°ì´í„°
  - name: confidence
    type: number
    description: ì¶”ì¶œ ì‹ ë¢°ë„ (0-1)

parameters:
  - name: table_position
    type: select
    options:
      - auto
      - top_left
      - top_right
      - bottom_left
      - bottom_right
    default: auto
    description: Parts List ìœ„ì¹˜ (auto=ìë™ ê²€ì¶œ)

  - name: ocr_engine
    type: select
    options:
      - tesseract
      - paddle
      - easyocr
    default: paddle
    description: OCR ì—”ì§„ ì„ íƒ (paddle ê¶Œì¥ - í•œê¸€ ì§€ì›)

  - name: normalize_material
    type: boolean
    default: true
    description: ì¬ì§ˆ ì½”ë“œ ìë™ ì •ê·œí™” (SF440 â†’ SF440A)

  - name: normalize_headers
    type: boolean
    default: true
    description: í—¤ë” ìë™ ì •ê·œí™” (MAT'L â†’ material)

  - name: expected_headers
    type: checkboxGroup
    default: ["no", "part_name", "material", "quantity"]
    options:
      - no
      - part_name
      - material
      - quantity
      - remarks
      - drawing_no
      - weight
      - specification
    description: ì˜ˆìƒë˜ëŠ” í—¤ë” í•„ë“œ

i18n:
  ko:
    label: Parts List Parser
    description: ë„ë©´ Parts Listì—ì„œ ë¶€í’ˆë²ˆí˜¸, í’ˆëª…, ì¬ì§ˆ, ìˆ˜ëŸ‰ ìë™ ì¶”ì¶œ
  en:
    label: Parts List Parser
    description: Extract part number, name, material, quantity from Parts List

profiles:
  default: bearing
  available:
    - name: bearing
      label: "ë² ì–´ë§ ë„ë©´"
      description: "DSE Bearing ë„ë©´ Parts List ìµœì í™”"
      params:
        table_position: auto
        ocr_engine: paddle
        normalize_material: true
        normalize_headers: true

    - name: generic
      label: "ì¼ë°˜ ë„ë©´"
      description: "ë²”ìš© Parts List íŒŒì‹±"
      params:
        table_position: auto
        ocr_engine: tesseract
        normalize_material: true
        normalize_headers: true

    - name: korean
      label: "í•œê¸€ ë„ë©´"
      description: "í•œê¸€ í—¤ë” Parts List"
      params:
        table_position: auto
        ocr_engine: paddle
        normalize_material: true
        normalize_headers: true

examples:
  - "ë„ë©´ ì´ë¯¸ì§€ â†’ Parts List Parser â†’ ë¶€í’ˆ ëª©ë¡ ì¶”ì¶œ"
  - "Parts List Parser â†’ BOM Matcher â†’ ìë™ BOM ë§¤ì¹­"

usageTips:
  - "â­ DSE Bearing ë„ë©´ì€ 'bearing' í”„ë¡œíŒŒì¼ ì‚¬ìš© ê¶Œì¥"
  - "ğŸ’¡ normalize_material=trueë¡œ ì¬ì§ˆ ì½”ë“œ ìë™ í†µì¼"
  - "ğŸ”— Title Block Parserì™€ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ ì™„ì „í•œ ë„ë©´ ì •ë³´ ì¶”ì¶œ"
  - "ğŸ“Š parts_countë¡œ ì¶”ì¶œëœ ë¶€í’ˆ ê°œìˆ˜ í™•ì¸"

recommendedInputs:
  - from: imageinput
    field: image
    reason: "ë„ë©´ ì´ë¯¸ì§€ ì…ë ¥"
  - from: tabledetector
    field: tables
    reason: "Table Detector ê²°ê³¼ ì¬ì‚¬ìš© ê°€ëŠ¥"

resources:
  gpu:
    vram: "~1GB"
    minVram: 512
    recommended: "CPUë¡œ ì¶©ë¶„"
  cpu:
    ram: "~2GB"
    minRam: 1024
    cores: 2
    note: "Table Detector í˜¸ì¶œ ì‹œ GPU ì‚¬ìš© ê°€ëŠ¥"

openapi:
  requestExamples:
    - name: "ë² ì–´ë§ ë„ë©´ Parts List"
      description: "DSE Bearing ë„ë©´ì—ì„œ Parts List ì¶”ì¶œ"
      formData:
        file: "TD0062018.png"
        ocr_engine: "paddle"
        normalize_material: true

  responseExamples:
    - name: "ì„±ê³µ ì‘ë‹µ"
      statusCode: 200
      response:
        success: true
        parts_list:
          headers: ["no", "part_name", "material", "quantity", "remarks"]
          parts:
            - no: 1
              part_name: "BEARING CASING ASSY(T1)"
              material: "SF440A"
              quantity: 1
              remarks: ""
            - no: 2
              part_name: "LINER PAD"
              material: "ASTM B23 GR.2"
              quantity: 8
              remarks: "BABBITT"
        parts_count: 2
        confidence: 0.89
        processing_time_ms: 1850

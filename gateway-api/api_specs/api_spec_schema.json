{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "API Specification Schema",
  "description": "BlueprintFlow API 자동 통합을 위한 표준 스펙",
  "type": "object",
  "required": ["apiVersion", "kind", "metadata", "server", "blueprintflow"],
  "properties": {
    "apiVersion": {
      "type": "string",
      "enum": ["v1"],
      "description": "스펙 버전"
    },
    "kind": {
      "type": "string",
      "enum": ["APISpec"],
      "description": "스펙 종류"
    },
    "metadata": {
      "type": "object",
      "required": ["id", "name", "version", "port"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_-]*$",
          "description": "API 고유 ID (소문자, 숫자, _, - 허용)"
        },
        "name": {
          "type": "string",
          "description": "API 표시 이름"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "API 버전 (semver)"
        },
        "port": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 65535,
          "description": "API 서버 포트"
        },
        "host": {
          "type": "string",
          "description": "Docker 서비스명 (docker-compose 내 서비스 이름)"
        },
        "description": {
          "type": "string",
          "description": "API 설명"
        },
        "author": {
          "type": "string",
          "description": "개발자/팀"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "검색/분류용 태그"
        }
      }
    },
    "server": {
      "type": "object",
      "required": ["endpoint", "method"],
      "properties": {
        "baseUrl": {
          "type": "string",
          "description": "기본 URL (미지정시 docker-compose 서비스명 사용)"
        },
        "endpoint": {
          "type": "string",
          "description": "API 엔드포인트 경로"
        },
        "method": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "DELETE"],
          "default": "POST"
        },
        "contentType": {
          "type": "string",
          "enum": ["multipart/form-data", "application/json"],
          "default": "multipart/form-data"
        },
        "timeout": {
          "type": "integer",
          "default": 60,
          "description": "요청 타임아웃 (초)"
        },
        "healthEndpoint": {
          "type": "string",
          "default": "/health",
          "description": "헬스체크 엔드포인트"
        }
      }
    },
    "blueprintflow": {
      "type": "object",
      "required": ["category", "color", "icon"],
      "properties": {
        "category": {
          "type": "string",
          "enum": ["input", "detection", "ocr", "segmentation", "preprocessing", "analysis", "knowledge", "ai", "control"],
          "description": "노드 팔레트 카테고리"
        },
        "color": {
          "type": "string",
          "pattern": "^#[0-9a-fA-F]{6}$",
          "description": "노드 색상 (hex)"
        },
        "icon": {
          "type": "string",
          "description": "Lucide 아이콘 이름 또는 이모지"
        },
        "requiresImage": {
          "type": "boolean",
          "default": true,
          "description": "이미지 입력 필요 여부"
        },
        "recommendedInputs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "from": { "type": "string" },
              "field": { "type": "string" },
              "reason": { "type": "string" }
            }
          }
        }
      }
    },
    "inputs": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "type"],
        "properties": {
          "name": { "type": "string" },
          "type": { "type": "string" },
          "required": { "type": "boolean", "default": false },
          "description": { "type": "string" }
        }
      }
    },
    "outputs": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "type"],
        "properties": {
          "name": { "type": "string" },
          "type": { "type": "string" },
          "description": { "type": "string" }
        }
      }
    },
    "parameters": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "type", "default"],
        "properties": {
          "name": { "type": "string" },
          "type": {
            "type": "string",
            "enum": ["string", "number", "integer", "boolean", "select"]
          },
          "default": {},
          "required": { "type": "boolean", "default": false },
          "min": { "type": "number" },
          "max": { "type": "number" },
          "step": { "type": "number" },
          "options": {
            "type": "array",
            "items": { "type": "string" }
          },
          "description": { "type": "string" },
          "uiType": {
            "type": "string",
            "enum": ["text", "number", "checkbox", "select", "slider", "textarea"],
            "description": "프론트엔드 UI 컴포넌트 타입 (생략 시 type 기반 자동 결정)"
          },
          "formField": {
            "type": "string",
            "description": "API 요청 시 사용할 필드명 (다르면 매핑)"
          }
        }
      }
    },
    "mappings": {
      "type": "object",
      "description": "입출력 필드 매핑 (워크플로우 <-> API)",
      "properties": {
        "input": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        },
        "output": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        }
      }
    },
    "i18n": {
      "type": "object",
      "description": "다국어 지원",
      "properties": {
        "ko": {
          "type": "object",
          "properties": {
            "label": { "type": "string" },
            "description": { "type": "string" },
            "parameters": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            }
          }
        },
        "en": {
          "type": "object",
          "properties": {
            "label": { "type": "string" },
            "description": { "type": "string" },
            "parameters": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            }
          }
        }
      }
    },
    "examples": {
      "type": "array",
      "items": { "type": "string" },
      "description": "사용 예시"
    },
    "usageTips": {
      "type": "array",
      "items": { "type": "string" },
      "description": "사용 팁"
    },
    "resources": {
      "type": "object",
      "description": "리소스 요구사항 (GPU/CPU 모드별)",
      "properties": {
        "gpu": {
          "type": "object",
          "properties": {
            "vram": {
              "type": "string",
              "description": "예상 VRAM 사용량 (예: ~2GB, 2-4GB, -)"
            },
            "minVram": {
              "type": "integer",
              "description": "최소 VRAM (MB)"
            },
            "recommended": {
              "type": "string",
              "description": "권장 GPU (예: RTX 3060 이상)"
            },
            "cudaVersion": {
              "type": "string",
              "description": "필요 CUDA 버전"
            }
          }
        },
        "cpu": {
          "type": "object",
          "properties": {
            "ram": {
              "type": "string",
              "description": "예상 RAM 사용량 (예: ~3GB)"
            },
            "minRam": {
              "type": "integer",
              "description": "최소 RAM (MB)"
            },
            "cores": {
              "type": "integer",
              "description": "권장 CPU 코어 수"
            },
            "note": {
              "type": "string",
              "description": "CPU 모드 관련 참고사항"
            }
          }
        },
        "parameterImpact": {
          "type": "array",
          "description": "하이퍼파라미터가 리소스에 미치는 영향",
          "items": {
            "type": "object",
            "properties": {
              "parameter": {
                "type": "string",
                "description": "파라미터 이름"
              },
              "impact": {
                "type": "string",
                "description": "영향 설명 (예: imgsz↑ → VRAM↑)"
              },
              "examples": {
                "type": "string",
                "description": "구체적 예시 (예: 640:1.5GB, 1280:2.5GB)"
              }
            }
          }
        }
      }
    }
  }
}

# BOM Matcher API Specification
# Gateway ë‚´ë¶€ ì²˜ë¦¬ (ë³„ë„ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì—†ìŒ)
# Title Block + Parts List + Dimension â†’ í†µí•© BOM ìƒì„±

apiVersion: v1
kind: APISpec

metadata:
  id: bommatcher
  name: BOM Matcher
  version: 1.0.0
  port: 8000  # Gateway ë‚´ë¶€ ì²˜ë¦¬
  host: gateway-api
  description: ë„ë©´ ë¶„ì„ ê²°ê³¼ë¥¼ í†µí•©í•˜ì—¬ BOM(Bill of Materials) ìë™ ìƒì„±
  author: AX Team
  tags:
    - analysis
    - bom
    - bearing
    - integration

server:
  endpoint: /api/v1/bom/match
  method: POST
  contentType: application/json
  timeout: 60
  healthEndpoint: /health

blueprintflow:
  category: analysis
  color: "#059669"
  icon: Package
  requiresImage: false

inputs:
  - name: titleblock_data
    type: TitleBlockData
    required: false
    description: Title Block Parser ì¶œë ¥ (ë„ë©´ë²ˆí˜¸, Rev, í’ˆëª… ë“±)
  - name: partslist_data
    type: PartsListData[]
    required: false
    description: Parts List Parser ì¶œë ¥ (ë¶€í’ˆ ëª©ë¡)
  - name: dimension_data
    type: BearingSpec
    required: false
    description: Dimension Parser ì¶œë ¥ (ì¹˜ìˆ˜ ì •ë³´)
  - name: yolo_detections
    type: Detection[]
    required: false
    description: YOLO ê²€ì¶œ ê²°ê³¼ (ì‹¬ë³¼, ì˜ì—­)
  - name: ocr_results
    type: TextResult[]
    required: false
    description: OCR ê²°ê³¼ (ì¶”ê°€ í…ìŠ¤íŠ¸)

outputs:
  - name: bom
    type: BOMEntry[]
    description: í†µí•© BOM ëª©ë¡
  - name: drawing_info
    type: DrawingInfo
    description: ë„ë©´ ë©”íƒ€ ì •ë³´
  - name: match_confidence
    type: number
    description: ë§¤ì¹­ ì‹ ë¢°ë„ (0-1)
  - name: unmatched_items
    type: string[]
    description: ë§¤ì¹­ë˜ì§€ ì•Šì€ í•­ëª© ëª©ë¡
  - name: warnings
    type: string[]
    description: ì²˜ë¦¬ ì¤‘ ë°œìƒí•œ ê²½ê³ 

parameters:
  - name: match_strategy
    type: select
    options:
      - strict
      - fuzzy
      - hybrid
    default: hybrid
    description: ë§¤ì¹­ ì „ëµ (strict=ì •í™•ì¼ì¹˜, fuzzy=ìœ ì‚¬ì¼ì¹˜, hybrid=ë³µí•©)

  - name: confidence_threshold
    type: number
    min: 0
    max: 1
    step: 0.05
    default: 0.7
    description: ë§¤ì¹­ ìµœì†Œ ì‹ ë¢°ë„

  - name: include_dimensions
    type: boolean
    default: true
    description: ì¹˜ìˆ˜ ì •ë³´ í¬í•¨ ì—¬ë¶€

  - name: include_tolerances
    type: boolean
    default: true
    description: ê³µì°¨ ì •ë³´ í¬í•¨ ì—¬ë¶€

  - name: validate_material
    type: boolean
    default: true
    description: ì¬ì§ˆ ì½”ë“œ ê²€ì¦

  - name: output_format
    type: select
    options:
      - json
      - excel
      - csv
    default: json
    description: ì¶œë ¥ í˜•ì‹

i18n:
  ko:
    label: BOM Matcher
    description: ë„ë©´ ë¶„ì„ ê²°ê³¼ë¥¼ í†µí•©í•˜ì—¬ BOM ìë™ ìƒì„±
  en:
    label: BOM Matcher
    description: Auto-generate BOM by integrating drawing analysis results

profiles:
  default: bearing
  available:
    - name: bearing
      label: "ë² ì–´ë§ BOM"
      description: "DSE Bearing ë„ë©´ BOM ìµœì í™”"
      params:
        match_strategy: hybrid
        confidence_threshold: 0.7
        include_dimensions: true
        include_tolerances: true
        validate_material: true
        output_format: json

    - name: general
      label: "ì¼ë°˜ BOM"
      description: "ë²”ìš© BOM ìƒì„±"
      params:
        match_strategy: fuzzy
        confidence_threshold: 0.6
        include_dimensions: false
        include_tolerances: false
        validate_material: false
        output_format: json

    - name: strict
      label: "ì •ë°€ BOM"
      description: "ë†’ì€ ì‹ ë¢°ë„ ë§¤ì¹­"
      params:
        match_strategy: strict
        confidence_threshold: 0.9
        include_dimensions: true
        include_tolerances: true
        validate_material: true
        output_format: json

examples:
  - "Title Block + Parts List â†’ í†µí•© BOM"
  - "ë„ë©´ë²ˆí˜¸ BRG-001, ë¶€í’ˆ 3ê°œ â†’ êµ¬ì¡°í™”ëœ BOM JSON"
  - "ì¹˜ìˆ˜ ì •ë³´ í¬í•¨ BOM â†’ OD/ID í•„ë“œ ì¶”ê°€"

usageTips:
  - "â­ Title Block â†’ Parts List â†’ Dimension â†’ BOM Matcher ìˆœì„œ ì—°ê²°"
  - "ğŸ’¡ match_strategy=hybridë¡œ ìµœì  ë§¤ì¹­"
  - "ğŸ“‹ Excel ì¶œë ¥ìœ¼ë¡œ ê³ ê° ì œì¶œìš© BOM ìƒì„±"
  - "ğŸ”— Blueprint AI BOMê³¼ ì—°ë™ ê°€ëŠ¥"

recommendedInputs:
  - from: titleblock
    field: titleblock_data
    reason: "â­ ë„ë©´ ë©”íƒ€ ì •ë³´ (ë„ë©´ë²ˆí˜¸, Rev)"
  - from: partslist
    field: partslist_data
    reason: "â­ ë¶€í’ˆ ëª©ë¡ (í’ˆë²ˆ, í’ˆëª…, ì¬ì§ˆ)"
  - from: dimensionparser
    field: dimension_data
    reason: "ì¹˜ìˆ˜ ì •ë³´ (OD/ID, ê³µì°¨)"
  - from: yolo
    field: yolo_detections
    reason: "ì‹¬ë³¼ ê²€ì¶œ ê²°ê³¼"

resources:
  gpu:
    vram: "0"
    recommended: "CPUë¡œ ì¶©ë¶„ (ë§¤ì¹­ ë¡œì§)"
  cpu:
    ram: "~512MB"
    minRam: 256
    cores: 1
    note: "ê²½ëŸ‰ ë§¤ì¹­ ì‘ì—…"

openapi:
  requestExamples:
    - name: "ë² ì–´ë§ BOM ìƒì„±"
      description: "Title Block + Parts List + Dimension í†µí•©"
      jsonBody:
        titleblock_data:
          drawing_number: "BRG-2024-001"
          revision: "A"
          title: "THRUST BEARING ASSEMBLY"
          material: "SF440A"
        partslist_data:
          - part_no: "1"
            part_name: "UPPER THRUST PAD"
            material: "BABBITT"
            quantity: 8
          - part_no: "2"
            part_name: "LOWER THRUST PAD"
            material: "BABBITT"
            quantity: 8
        dimension_data:
          outer_diameter: 670
          inner_diameter: 440
          length: 200
        match_strategy: "hybrid"

  responseExamples:
    - name: "ì„±ê³µ ì‘ë‹µ"
      statusCode: 200
      response:
        success: true
        bom:
          - item_no: 1
            part_no: "1"
            part_name: "UPPER THRUST PAD"
            material: "ASTM B23 GR.2"
            quantity: 8
            dimensions:
              od: 670
              id: 440
            match_confidence: 0.95
          - item_no: 2
            part_no: "2"
            part_name: "LOWER THRUST PAD"
            material: "ASTM B23 GR.2"
            quantity: 8
            dimensions:
              od: 670
              id: 440
            match_confidence: 0.95
        drawing_info:
          drawing_number: "BRG-2024-001"
          revision: "A"
          title: "THRUST BEARING ASSEMBLY"
          base_material: "SF440A"
        match_confidence: 0.95
        unmatched_items: []
        warnings: []
        processing_time_ms: 120

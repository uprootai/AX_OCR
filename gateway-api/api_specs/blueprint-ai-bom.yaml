# Blueprint AI BOM API Specification
# Human-in-the-Loop ê¸°ë°˜ ë„ë©´ ë¶„ì„ ë° BOM ìƒì„±
# BlueprintFlow í†µí•© ìŠ¤í™

apiVersion: v1
kind: APISpec

metadata:
  id: blueprint-ai-bom
  name: Blueprint AI BOM
  version: 8.0.0
  port: 5020
  host: blueprint-ai-bom-backend  # Docker ì„œë¹„ìŠ¤ëª…
  description: AI ê¸°ë°˜ ë„ë©´ ë¶„ì„ ë° BOM ìƒì„±. Human-in-the-Loop ê²€ì¦ UI ì œê³µ.
  author: AX Team
  tags:
    - bom
    - detection
    - verification
    - human-in-the-loop
    - export
    - feedback
    - yolo-training

server:
  endpoint: /detection/{session_id}/detect
  method: POST
  contentType: application/json
  timeout: 120
  healthEndpoint: /health

blueprintflow:
  category: analysis
  color: "#8b5cf6"
  icon: FileSpreadsheet
  requiresImage: true
  interactiveMode: true  # Human-in-the-Loop UI í•„ìš”
  uiUrl: "http://localhost:3000"  # Frontend URL
  recommendedInputs:
    - from: yolo
      field: detections
      reason: YOLO ê²€ì¶œ ê²°ê³¼ë¥¼ BOM ê²€ì¦ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©
    - from: imageinput
      field: image
      reason: ì›ë³¸ ë„ë©´ ì´ë¯¸ì§€

inputs:
  - name: image
    type: Image
    required: true
    description: ë¶„ì„í•  ë„ë©´ ì´ë¯¸ì§€
  - name: detections
    type: DetectionResult[]
    required: true
    description: YOLO ë…¸ë“œì˜ ê²€ì¶œ ê²°ê³¼ (í•„ìˆ˜ - YOLO ë…¸ë“œ ì—°ê²° í•„ìš”)

outputs:
  - name: bom_data
    type: BOMData
    description: ìƒì„±ëœ BOM ë°ì´í„° (í’ˆëª©ë³„ ìˆ˜ëŸ‰, ë‹¨ê°€, í•©ê³„)
  - name: items
    type: BOMItem[]
    description: BOM í•­ëª© ëª©ë¡
  - name: summary
    type: BOMSummary
    description: BOM ìš”ì•½ (ì´ ìˆ˜ëŸ‰, ì†Œê³„, ë¶€ê°€ì„¸, í•©ê³„)
  - name: approved_count
    type: number
    description: ìŠ¹ì¸ëœ ê²€ì¶œ ìˆ˜
  - name: export_url
    type: string
    description: BOM ë‹¤ìš´ë¡œë“œ URL

# 2025-12-22: drawing_typeì€ ImageInputìœ¼ë¡œ ì´ë™ë¨
# AI BOMì€ ì„¸ì…˜ ìƒì„± + ê¸°ëŠ¥ ì„ íƒ ìš©ë„ë¡œ ë³€ê²½
parameters:
  - name: features
    type: array
    default:
      - verification
    required: false
    description: í™œì„±í™”í•  ê¸°ëŠ¥ ëª©ë¡. ê²€ì¦ UIì—ì„œ ì‚¬ìš©í•  ê¸°ëŠ¥ì„ ì„ íƒí•©ë‹ˆë‹¤.
    items:
      type: string
      enum:
        - verification
        - gt_comparison
        - dimension_extraction
        - relation_analysis
    options:
      - value: verification
        label: Human-in-the-Loop ê²€ì¦
        description: ê²€ì¶œ ê²°ê³¼ë¥¼ ìˆ˜ë™ìœ¼ë¡œ í™•ì¸í•˜ê³  ìˆ˜ì •í•©ë‹ˆë‹¤. ê¸°ë³¸ ê¸°ëŠ¥.
      - value: gt_comparison
        label: GT ë¹„êµ ë¶„ì„
        description: Ground Truthì™€ ë¹„êµí•˜ì—¬ Precision, Recall, F1 Scoreë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
      - value: dimension_extraction
        label: ì¹˜ìˆ˜ ì¶”ì¶œ (Phase 2)
        description: OCRë¡œ ì¹˜ìˆ˜ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤. ê°œë°œ ì¤‘.
        disabled: true
      - value: relation_analysis
        label: ì‹¬ë³¼-ì¹˜ìˆ˜ ê´€ê³„ ë¶„ì„ (Phase 2)
        description: ì‹¬ë³¼ê³¼ ì¹˜ìˆ˜ ê°„ì˜ ê´€ê³„ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤. ê°œë°œ ì¤‘.
        disabled: true
    tooltip: |
      ê²€ì¦ UIì—ì„œ ì‚¬ìš©í•  ê¸°ëŠ¥ì„ ì„ íƒí•©ë‹ˆë‹¤.
      â€¢ verification: ê¸°ë³¸ ê²€ì¦ ê¸°ëŠ¥ (í•„ìˆ˜)
      â€¢ gt_comparison: Ground Truth ë¹„êµ ë©”íŠ¸ë¦­ í‘œì‹œ
      â€¢ dimension_extraction: OCR ê¸°ë°˜ ì¹˜ìˆ˜ ì¶”ì¶œ (Phase 2)
      â€¢ relation_analysis: ì‹¬ë³¼-ì¹˜ìˆ˜ ê´€ê³„ ë¶„ì„ (Phase 2)

mappings:
  input:
    image: image
    detections: detections
  output:
    bom_data: bom_data
    items: bom_data.items
    summary: bom_data.summary
    approved_count: approved_count
    export_url: export_url

i18n:
  ko:
    label: Blueprint AI BOM
    description: YOLO ê²€ì¶œ ê²°ê³¼ë¡œ BOM ì„¸ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤. ê²€ì¦ UIì—ì„œ í™•ì¸ í›„ BOM ìƒì„±.
  en:
    label: Blueprint AI BOM
    description: Create BOM session from YOLO detections. Review in verification UI then generate BOM.

examples:
  - ë„ë©´ ì´ë¯¸ì§€ â†’ YOLO ê²€ì¶œ â†’ Blueprint AI BOM â†’ ê²€ì¦ UI â†’ BOM ìƒì„±

usageTips:
  - "â­ YOLO ë…¸ë“œ ì—°ê²° í•„ìˆ˜"
  - "ğŸ’¡ ì„¸ì…˜ ìƒì„± í›„ ê²€ì¦ UI(localhost:3000)ì—ì„œ BOM ìƒì„±"
  - "27ê°œ ì „ê¸° íŒ¨ë„ ë¶€í’ˆ í´ë˜ìŠ¤ ì§€ì›"

# ì§€ì› í´ë˜ìŠ¤ ëª©ë¡
supportedClasses:
  - beam
  - bolt
  - channel
  - clamp
  - elbow
  - flange
  - gasket
  - hbeam
  - ibeam
  - nut
  - pipe
  - plate
  - pump
  - reducer
  - tank
  - tee
  - union
  - valve
  - vessel
  - washer
  - weldneck
  - cap
  - coupling
  - cross
  - expansion_joint
  - filter
  - strainer

resources:
  cpu:
    ram: "~512MB"
    minRam: 256
    cores: 2
    note: "ì„¸ì…˜ ê´€ë¦¬ ë° BOM ìƒì„±ë§Œ ìˆ˜í–‰ (ê²€ì¶œì€ YOLO ë…¸ë“œì—ì„œ)"

# Title Block Parser API Specification
# Gateway ë‚´ë¶€ ì²˜ë¦¬ (ë³„ë„ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì—†ìŒ)
# Table Detector + ì •ê·œì‹ ê¸°ë°˜ í•„ë“œ íŒŒì‹±

apiVersion: v1
kind: APISpec

metadata:
  id: titleblock
  name: Title Block Parser
  version: 1.0.0
  port: 8000  # Gateway ë‚´ë¶€ ì²˜ë¦¬
  host: gateway-api
  description: ë„ë©´ Title Blockì—ì„œ ë„ë©´ë²ˆí˜¸, Rev, í’ˆëª…, ì¬ì§ˆ ë“± êµ¬ì¡°í™”ëœ ì •ë³´ ì¶”ì¶œ
  author: AX Team
  tags:
    - analysis
    - title-block
    - drawing-info
    - ocr

server:
  endpoint: /api/v1/titleblock/parse
  method: POST
  contentType: multipart/form-data
  timeout: 60
  healthEndpoint: /health

blueprintflow:
  category: analysis
  color: "#6366f1"
  icon: FileText
  requiresImage: true

inputs:
  - name: image
    type: Image
    required: true
    description: ë„ë©´ ì´ë¯¸ì§€ (Title Block í¬í•¨)

outputs:
  - name: title_block
    type: TitleBlockData
    description: íŒŒì‹±ëœ Title Block í•„ë“œ
  - name: drawing_number
    type: string
    description: ë„ë©´ë²ˆí˜¸ (ì˜ˆ: TD0062018)
  - name: revision
    type: string
    description: ë¦¬ë¹„ì „ (ì˜ˆ: A, B, C)
  - name: part_name
    type: string
    description: í’ˆëª… (ì˜ˆ: BEARING CASING ASSY)
  - name: material
    type: string
    description: ì¬ì§ˆ (ì˜ˆ: SF440A, SS400)
  - name: weight
    type: string
    description: ì¤‘ëŸ‰ (ì˜ˆ: 882 kg)
  - name: scale
    type: string
    description: ì¶•ì²™ (ì˜ˆ: 1:1, 1:2)
  - name: raw_text
    type: string
    description: Title Block OCR ì›ë³¸ í…ìŠ¤íŠ¸
  - name: confidence
    type: number
    description: íŒŒì‹± ì‹ ë¢°ë„ (0-1)

parameters:
  - name: detection_method
    type: select
    options:
      - auto
      - table_detector
      - template
    default: auto
    description: "ê²€ì¶œ ë°©ì‹: auto(ìë™ ì„ íƒ), table_detector(í…Œì´ë¸” ê²€ì¶œ), template(ì¢Œí‘œ ê¸°ë°˜)"

  - name: title_block_position
    type: select
    options:
      - bottom_right
      - bottom_left
      - top_right
      - auto
    default: bottom_right
    description: Title Block ìœ„ì¹˜ (ëŒ€ë¶€ë¶„ ìš°í•˜ë‹¨)

  - name: ocr_engine
    type: select
    options:
      - tesseract
      - paddle
      - easyocr
    default: paddle
    description: OCR ì—”ì§„ ì„ íƒ (paddle ê¶Œì¥ - í•œê¸€ ì§€ì›)

  - name: company_template
    type: select
    options:
      - auto
      - doosan
      - generic
    default: auto
    description: íšŒì‚¬ë³„ Title Block í…œí”Œë¦¿

  - name: extract_fields
    type: checkboxGroup
    default: ["drawing_number", "revision", "part_name", "material"]
    options:
      - drawing_number
      - revision
      - part_name
      - material
      - weight
      - scale
      - date
      - author
    description: ì¶”ì¶œí•  í•„ë“œ ì„ íƒ

i18n:
  ko:
    label: Title Block Parser
    description: ë„ë©´ Title Blockì—ì„œ ë„ë©´ë²ˆí˜¸, Rev, í’ˆëª…, ì¬ì§ˆ ë“± ìë™ ì¶”ì¶œ
  en:
    label: Title Block Parser
    description: Extract drawing number, revision, part name, material from title block

profiles:
  default: bearing
  available:
    - name: bearing
      label: "ë² ì–´ë§ ë„ë©´"
      description: "DSE Bearing ë„ë©´ ìµœì í™” (DOOSAN í…œí”Œë¦¿)"
      params:
        detection_method: auto
        title_block_position: bottom_right
        ocr_engine: paddle
        company_template: doosan
        extract_fields: ["drawing_number", "revision", "part_name", "material", "weight"]

    - name: generic
      label: "ì¼ë°˜ ë„ë©´"
      description: "ë²”ìš© Title Block íŒŒì‹±"
      params:
        detection_method: table_detector
        title_block_position: auto
        ocr_engine: tesseract
        company_template: generic
        extract_fields: ["drawing_number", "revision", "part_name", "material"]

    - name: fast
      label: "ë¹ ë¥¸ ì¶”ì¶œ"
      description: "ë„ë©´ë²ˆí˜¸/Revë§Œ ë¹ ë¥´ê²Œ ì¶”ì¶œ"
      params:
        detection_method: template
        title_block_position: bottom_right
        ocr_engine: tesseract
        company_template: auto
        extract_fields: ["drawing_number", "revision"]

examples:
  - "ë„ë©´ ì´ë¯¸ì§€ â†’ Title Block Parser â†’ ë„ë©´ë²ˆí˜¸, í’ˆëª…, ì¬ì§ˆ ì¶”ì¶œ"
  - "ë² ì–´ë§ ë„ë©´ â†’ Title Block Parser â†’ BOM Matcher ì—°ê²°"

usageTips:
  - "â­ DSE Bearing ë„ë©´ì€ 'bearing' í”„ë¡œíŒŒì¼ ì‚¬ìš© ê¶Œì¥"
  - "ğŸ’¡ DOOSAN ë„ë©´ì€ company_template=doosanìœ¼ë¡œ ì •í™•ë„ í–¥ìƒ"
  - "ğŸ”— BOM Matcher ë…¸ë“œì™€ ì—°ê²°í•˜ì—¬ ìë™ BOM ë§¤ì¹­"
  - "ğŸ“Š confidence ê°’ì´ 0.7 ì´í•˜ë©´ ìˆ˜ë™ í™•ì¸ ê¶Œì¥"

recommendedInputs:
  - from: imageinput
    field: image
    reason: "ë„ë©´ ì´ë¯¸ì§€ ì…ë ¥"
  - from: tabledetector
    field: tables
    reason: "Table Detector ê²°ê³¼ë¡œ Title Block ì˜ì—­ ì¬ì‚¬ìš© ê°€ëŠ¥"

resources:
  gpu:
    vram: "~1GB"
    minVram: 512
    recommended: "CPUë¡œ ì¶©ë¶„"
  cpu:
    ram: "~2GB"
    minRam: 1024
    cores: 2
    note: "ì •ê·œì‹ íŒŒì‹±ì€ CPU ë¶€í•˜ ë‚®ìŒ"

openapi:
  requestExamples:
    - name: "ë² ì–´ë§ ë„ë©´ íŒŒì‹±"
      description: "DOOSAN ë² ì–´ë§ ë„ë©´ì—ì„œ Title Block ì¶”ì¶œ"
      formData:
        file: "TD0062018.png"
        detection_method: "auto"
        company_template: "doosan"
        ocr_engine: "paddle"

  responseExamples:
    - name: "ì„±ê³µ ì‘ë‹µ"
      statusCode: 200
      response:
        success: true
        title_block:
          drawing_number: "TD0062018"
          revision: "A"
          part_name: "BEARING CASING ASSY(T1)"
          material: "SF440A"
          weight: "882 kg"
          scale: "1:1"
        confidence: 0.92
        raw_text: "DWG NO. TD0062018 REV A..."
        processing_time_ms: 1250

# Line Detector API Specification
apiVersion: v1
kind: APISpec

metadata:
  id: linedetector
  name: Line Detector
  version: 1.0.0
  port: 5016
  host: line-detector-api
  description: P&ID 라인(배관/신호선) 검출 및 연결성 분석 API
  author: AX Team
  tags:
    - segmentation
    - pid

server:
  endpoint: /api/v1/process
  method: POST
  contentType: multipart/form-data
  timeout: 60
  healthEndpoint: /api/v1/health

blueprintflow:
  category: segmentation
  color: "#0d9488"
  icon: Minus
  requiresImage: true

inputs:
  - name: image
    type: Image
    required: true
    description: P&ID 도면 이미지

outputs:
  - name: lines
    type: array
    description: 검출된 라인 목록
  - name: intersections
    type: array
    description: 교차점 목록
  - name: statistics
    type: object
    description: 라인 통계
  - name: visualization
    type: string
    description: 시각화 이미지 (base64)

parameters:
  - name: method
    type: select
    options:
      - lsd
      - hough
      - combined
    default: lsd
    description: 검출 방식
  - name: merge_lines
    type: boolean
    default: true
    description: 공선 라인 병합
  - name: classify_types
    type: boolean
    default: true
    description: 라인 유형 분류 (배관/신호선)
  - name: classify_colors
    type: boolean
    default: true
    description: 색상 기반 라인 분류 (공정/냉각/증기/신호선 등)
  - name: classify_styles
    type: boolean
    default: true
    description: 스타일 분류 (실선/점선/점점선)
  - name: find_intersections
    type: boolean
    default: true
    description: 교차점 검출
  - name: visualize
    type: boolean
    default: true
    description: 결과 시각화
  - name: min_length
    type: number
    min: 0
    max: 500
    default: 0
    step: 10
    description: 최소 라인 길이 (픽셀). 짧은 라인 필터링. 0=필터링 안함
  - name: max_lines
    type: number
    min: 0
    max: 5000
    default: 0
    step: 100
    description: 최대 라인 수 제한. 긴 라인 우선. 0=제한 없음

i18n:
  ko:
    label: Line Detector
    description: P&ID 라인(배관/신호선) 검출 및 연결성 분석
  en:
    label: Line Detector
    description: P&ID line detection and connectivity analysis

resources:
  gpu:
    vram: "N/A"
    minVram: 0
    recommended: "CPU 전용"
    cudaVersion: "N/A"
  cpu:
    ram: "~2GB"
    minRam: 1024
    cores: 2
    note: "OpenCV 기반 - CPU로 빠름"
  parameterImpact:
    - parameter: method
      impact: "combined 방식 시 시간 2배"
      examples: "lsd:빠름, combined:보통"
    - parameter: min_length
      impact: "값↑ → 라인 수↓, 처리시간↓"
      examples: "0:전체, 30:중간, 50:긴 라인만"
    - parameter: max_lines
      impact: "값↓ → 라인 수↓, 처리시간↓"
      examples: "0:제한없음, 500:적당, 200:빠름"

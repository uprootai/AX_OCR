# Optimizing Text Recognition in Mechanical Drawings: A Comprehensive Approach

## 논문 정보
- **제목**: Optimizing Text Recognition in Mechanical Drawings: A Comprehensive Approach
- **저자**: Javier Villena Toro, Mehdi Tarkian
- **소속**: Linköping University, Department of Management and Engineering
- **게재**: Machines 2025, 13, 254
- **게재일**: 2025년 3월 20일
- **DOI**: 10.3390/machines13030254
- **관계**: 첫 번째 논문(eDOCr)의 개선된 후속 연구

## 연구 배경
- 공학 도면의 디지털화는 제품 개발 라이프사이클 자동화의 핵심
- 기존 솔루션들의 한계:
  - 산업 기대치에 미달하는 오픈소스 솔루션
  - 텍스트 추출뿐만 아니라 내용 해석 및 관련 정보 필터링 필요
- Vision Language (VL) 모델의 등장으로 새로운 가능성 열림

## eDOCr2 프레임워크

### 핵심 구조
eDOCr2는 전통적인 OCR과 이미지 처리를 결합하여 구조화된 정보 추출

### 3가지 주요 파이프라인

#### 1. 테이블 파이프라인 (Table Pipeline)
- **OCR 엔진**: Pytesseract
- **기능**: 정보 블록 및 첨부 테이블에서 구조화된 텍스트 추출
- **언어 지원**: 사용자가 도면 언어 지정 가능
- **VL 모델 통합**: Qwen2-VL-7B를 사용한 특정 정보 추출
  - 예: 부품 번호, 재료, 표면 처리 등

#### 2. FCF 파이프라인 (Feature Control Frame Pipeline)
- **방법**: 커스텀 CRNN 인식기 (합성 데이터로 훈련)
- **기능**: GD&T 기호 및 텍스트 정보 추출
- **특징**: GD&T UTF-8 문자를 일반 문자로 처리하여 인식

#### 3. 치수 파이프라인 (Dimension Pipeline)
- **텍스트 감지**: CRAFT 감지기 (사전 훈련)
- **전처리**:
  - 슬라이딩 윈도우로 이미지 분할
  - 클러스터링 알고리즘으로 텍스트 그룹화
- **인식**:
  - Pytesseract: 초기 분류
  - 커스텀 CRNN: 치수 전용 인식
- **후처리**:
  - 템플릿 매칭 (∅ 기호 감지)
  - 스트로크 보정 (얇은 텍스트)

### 분할(Segmentation) 기술
1. **프레임 감지**: 수평/수직 선 분석으로 내부 프레임 식별
2. **사각형 감지**: 윤곽 감지로 테이블 및 FCF 식별
3. **이미지 처리**: 프레임 내부로 자르고 예측된 박스 제거

## Vision Language 모델 통합

### 통합 지점
1. **정보 블록 데이터 추출** (Qwen2-VL-7B)
   - 구조화된 테이블에서 특정 정보 추출
   - Python 딕셔너리 형식으로 출력

2. **제조 맥락 이해** (GPT-4)
   - 정보 블록 + 부품 뷰 분석
   - 제조 공정 순서 식별
   - 예: 선삭, 드릴링, 밀링, 리밍, 연삭, 디버링

3. **품질 관리 체크리스트 생성** (GPT-4)
   - 품질 관리에서 확인 필요한 치수 식별
   - 핵심 측정값만 추출

4. **치수 파이프라인 대체**
   - Qwen2-VL-7B 또는 GPT-4o로 치수 직접 추출
   - 전통적 OCR보다 맥락 이해 우수

## 주요 성과

### 벤치마크 결과 (7개 도면)
| 메트릭 | eDOCr2 | GPT4o | eDOCr2 (GPT4o) |
|--------|---------|-------|----------------|
| **치수 재현율** | 93.75% | 84.14%* | 87.80%* |
| **FCF 재현율** | 100% | 0% | 100% |
| **FCF CER** | 5.70% | - | 5.70% |
| **치수 CER** | 0.73% | 1.95% | 1.83% |

*반복 치수를 일치로 간주하면 GPT4o: 92.68%, eDOCr2(GPT4o): 96.34%

### Ablation Study (처리 단계별 영향)
| 제거된 단계 | 재현율 | 정밀도 | IoU | CER | 문자 재현율 | 시간(초) |
|------------|--------|--------|-----|-----|-------------|---------|
| 프레임 감지 | 95.0% | 66.67% | 83.58% | 3.59% | 97.61% | 10.65 |
| 슬라이딩 윈도우 | 66.25% | 94.64% | 79.06% | 8.69% | 93.04% | 7.70 |
| 템플릿 매칭 | 93.75% | 94.94% | 85.30% | 2.20% | 97.80% | 10.39 |
| 스트로크 보정 | 93.75% | 96.15% | 86.38% | 2.69% | 98.77% | 10.46 |
| **모두 활성화** | **93.75%** | **96.15%** | **86.38%** | **0.73%** | **99.27%** | **10.69** |

### 기존 솔루션과 비교

#### vs eDOCr (이전 버전)
| 메트릭 | eDOCr | eDOCr2 | 개선율 |
|--------|-------|---------|--------|
| 감지 재현율 | 91% | 94% | +3% |
| 감지 정밀도 | 70% | 96% | +26% |
| CER | 8% | 0.7% | -91% |
| 처리 시간 | 53.5초 | 10.7초 | -80% |

#### vs DigiEDraw
- **평균 감지 재현율**: eDOCr2 94% vs DigiEDraw 88%
- **평균 감지 정밀도**: eDOCr2 93% vs DigiEDraw 72%
- DigiEDraw는 PDF 스크래핑 사용으로 벡터화된 PDF만 지원

#### vs Lin et al.
- **감지 정확도**: eDOCr2 100% vs Lin et al. 70%
- **인식 정확도**: eDOCr2 100% vs Lin et al. 80%
- **처리 시간**: eDOCr2 13.4초 vs Lin et al. 28.8초

## 기술적 세부사항

### 하드웨어
- GPU: Nvidia A4000 (16GB)
- CPU: AMD Ryzen 7700
- RAM: 64GB
- VL 모델 사용 시 2개의 GPU 필요 (TensorFlow + PyTorch)

### 모델 훈련
#### GD&T 인식기
- 알파벳: "0123456789., ABCDZ∅" + GD&T 기호
- 샘플: 25,000개
- 문자열 길이: (2, 6)
- 결과: CER 0.42%, 재현율 100%

#### 치수 인식기
- 알파벳: "0123456789AaBCDRGHhMmnxZtd(),.+-±:/°"∅="
- 샘플: 40,000개
- 문자열 길이: (4, 10)
- 에폭: 3회 (배치 크기 256)

### 클러스터링 알고리즘
- DBSCAN 대신 박스 경계 기반 클러스터링
- 기본 임계값: 20픽셀
- 공차 정보 그룹화에 효과적
- 중심점 기반보다 밀집 영역에서 우수

## 응용 분야

### 1. 품질 관리 자동화
- 검사 프로세스를 위한 치수 추출 및 검증
- 수동 작업 감소 및 오류 최소화

### 2. 도면 데이터베이스 관리
- 효율적인 인덱싱, 검색 및 필터링
- 메타데이터 자동 추출

### 3. CAD 시스템 통합
- 설계 파라미터 및 주석 자동 입력
- 메타데이터 채우기

### 4. BOM(자재 명세서) 생성
- 도면에서 부품 정보 자동 추출
- 수동 데이터 입력 시간 단축

### 5. 제조 공정 평가
- GPT-4를 사용한 제조 공정 시퀀스 식별
- 적절한 제조 방법 제안

## VL 모델의 장단점

### 장점
- 맥락 이해 및 추론 능력
- 구조화된 정보 추출 (Python 딕셔너리 형식)
- 복잡한 질의 처리 가능
- 특정 정보만 필터링 가능

### 단점
- 위치 정보 제공 안 함
- 서버 기반 모델의 데이터 보안 우려
- GPT-4o는 FCF 정보 추출 실패 (재현율 0%)
- 반복 치수 생략 경향
- 처리 시간이 전통적 OCR보다 긺

### 로컬 VL 모델 (Qwen2-VL-7B)
- 장점: 데이터 보안, 환경 친화적
- 단점: 정확도 저하, 공차 처리 어려움
- 간단한 도면에서는 좋은 성능

## 핵심 알고리즘

### 1. 프레임 감지 알고리즘
- 방향성 커널로 수평/수직 선 감지
- 이미지의 70% 이상 차지하는 최소 사각형 찾기
- 피크 검출로 프레임 경계 식별

### 2. 클러스터링 알고리즘
- 박스 경계 간 거리 기반 (중심점 기반 X)
- 임계값 ϵ로 그룹화 제어
- 공차 정보 결합에 효과적

### 3. 공차 확인 알고리즘
- 이미지 처리 규칙으로 공차 존재 식별
- y 좌표 기반 흑색 픽셀 탐색
- 명목값과 공차 박스 분리

## 한계 및 향후 과제

### 현재 한계
1. **수작업 도면**: 기계 인쇄 텍스트에 최적화되어 있음
2. **언어 의존성**: 훈련 알파벳에 제한됨
3. **임계값 민감도**: 도면마다 최적값이 다름
4. **벡터 도면 미지원**: 현재는 래스터 이미지만 처리

### 향후 연구 방향
1. 수작업 도면에 대한 VL 모델 활용
2. 라벨링된 ED 데이터셋 구축 및 공개
3. 하이브리드 접근법 개발 (VL + 전통 CV)
4. 다른 유형의 ED(P&ID 등)로 확장

## 주요 기여

1. **새로운 분할 기술**: 휴리스틱 기반 ED 분할로 텍스트 감지/정밀도 향상
2. **효율적 클러스터링**: DBSCAN 대신 박스 경계 기반 클러스터링
3. **첫 벤치마크 제공**: 주석이 달린 ED 데이터셋 제공
4. **VL 모델 통합**: ED 처리 프레임워크 내 최초 VL 모델 통합
5. **성능 향상**: 낮은 CER, 감소된 처리 시간, 우수한 전반적 성능
6. **직접 비교**: 기존 솔루션과의 일대일 성능 비교

## IDP (Intelligent Document Processing) 응용

### 전통적 OCR vs IDP
- **전통적 OCR**: 텍스트 인식만
- **IDP**: 텍스트 분석, 관련 정보 추출, 비즈니스 워크플로우 통합

### eDOCr2의 IDP 기능
1. 정보 추출 (1단계)
2. VL 모델로 추론 (2단계)
3. 다음 프로세스로 원활한 정보 흐름

## 오픈소스
- GitHub: https://github.com/javvi51/edocr2
- 코드 및 데이터 공개
- 연구 커뮤니티 기여

## 결론

eDOCr2는 전통적인 OCR과 최신 Vision Language 모델을 결합하여:
- **높은 정확도**: 텍스트 재현율 93.75%, CER < 1%
- **빠른 처리**: 이전 버전 대비 80% 시간 단축
- **유연한 통합**: VL 모델을 선택적으로 통합 가능
- **실용적 응용**: 품질 관리, BOM 생성, 제조 평가 등

하이브리드 접근법이 제조 산업의 자동화, 효율성, 정확성 향상에 중요한 역할을 할 것으로 전망됩니다.
